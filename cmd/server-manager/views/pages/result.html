{{ define "title" }}Results{{ end }}

{{ define "content" }}

    <a class="btn btn-primary" href="/results">
        Back to Results
    </a>

    {{ $sessionResults := .result }}
    <a name={{ $sessionResults.GetDate }}></a>
    <div class="card mt-3 border-secondary">
        <div class="card-header">
            <strong>{{ prettify $sessionResults.TrackName false }} {{ with $sessionResults.TrackConfig }} - {{ prettify . true }} {{ end }}</strong>
            on {{ $sessionResults.GetDate }}
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">

                    {{ if eq "BOOKING" $sessionResults.Type }}
                        <h3><strong>Booking</strong></h3>
                    {{ end }}

                    {{ if eq "PRACTICE" $sessionResults.Type }}
                        <h3><strong>Practice</strong></h3>
                    {{ end }}

                    {{ if eq "QUALIFY" $sessionResults.Type }}
                        <h3><strong>Qualifying</strong></h3>
                    {{ end }}

                    {{ if eq "RACE" $sessionResults.Type }}
                        <h3><strong>Race</strong></h3>
                    {{ end }}


                </div>

                <div class="col-md-6">
                    <img class="img-fluid float-right"
                         src="/content/tracks/{{ $sessionResults.TrackName }}/ui{{ with $sessionResults.TrackConfig }}/{{.}}{{ end }}/preview.png"
                         alt="{{ $sessionResults.TrackName }} {{ $sessionResults.TrackConfig }}"
                    >
                </div>
            </div>

            <div class="row mt-3">
                <div class="col-md-12">
                    {{ if eq "RACE" $sessionResults.Type }}
                        <div class="table-responsive">
                            <table class="table table-bordered table-striped">
                                <tr>
                                    <th>Position</th>
                                    <th>Name</th>
                                    <th>Team</th>
                                    <th>Car</th>
                                    <th>Total Race Time</th>
                                    <th>Num Laps</th>
                                    <th>Best Lap</th>
                                </tr>

                                {{ range $pos, $result := $sessionResults.Result}}
                                    <tr>
                                        <td>{{ add $pos 1 }}</td>
                                        <td class="driver-link" data-href="#{{ $result.DriverGUID }}">{{ $result.DriverName }}</td>
                                        <td>{{ $sessionResults.GetTeamName $result.DriverGUID }}</td>
                                        <td>{{ prettify $result.CarModel true }}</td>
                                        <td>{{ $sessionResults.GetTime $result.TotalTime $result.DriverGUID }}</td>
                                        <td>{{ $sessionResults.GetLaps $result.DriverGUID }} laps /
                                            {{ $sessionResults.GetCuts $result.DriverGUID }} cuts</td>
                                        <td>{{ $sessionResults.GetTime $result.BestLap $result.DriverGUID }}</td>
                                    </tr>
                                {{ end }}
                            </table>
                        </div>
                    {{ end }}

                    {{ if eq "QUALIFY" $sessionResults.Type }}
                        <div class="table-responsive">
                            <table class="table table-bordered table-striped">
                                <tr>
                                    <th>Position</th>
                                    <th>Name</th>
                                    <th>Team</th>
                                    <th>Car</th>
                                    <th>Qualifying Time</th>
                                    <th>Laps</th>
                                </tr>

                                {{ range $pos, $result := $sessionResults.Result }}
                                    <tr>
                                        <td>{{ add $pos 1 }}</td>
                                        <td>{{ $result.DriverName }}</td>
                                        <td>{{ $sessionResults.GetTeamName $result.DriverGUID }}</td>
                                        <td>{{ prettify $result.CarModel true }}</td>
                                        <td>{{ $sessionResults.GetTime $result.BestLap $result.DriverGUID }}</td>
                                        <td>{{ $sessionResults.GetLaps $result.DriverGUID }} laps /
                                            {{ $sessionResults.GetCuts $result.DriverGUID }} cuts</td>
                                    </tr>
                                {{ end }}
                            </table>
                        </div>
                    {{ end }}

                    {{ if eq "PRACTICE" $sessionResults.Type }}
                        <div class="table-responsive">
                            <table class="table table-bordered table-striped">
                                <tr>
                                    <th>Position</th>
                                    <th>Name</th>
                                    <th>Team</th>
                                    <th>Car</th>
                                    <th>Best Practice Lap</th>
                                    <th>Laps</th>
                                </tr>

                                {{ range $pos, $result := $sessionResults.Result }}
                                    <tr>
                                        <td>{{ add $pos 1 }}</td>
                                        <td>{{ $result.DriverName }}</td>
                                        <td>{{ $sessionResults.GetTeamName $result.DriverGUID }}</td>
                                        <td>{{ prettify $result.CarModel true }}</td>
                                        <td>{{ $sessionResults.GetTime $result.BestLap $result.DriverGUID }}</td>
                                        <td>{{ $sessionResults.GetLaps $result.DriverGUID }} laps /
                                            {{ $sessionResults.GetCuts $result.DriverGUID }} cuts</td>
                                    </tr>
                                {{ end }}
                            </table>
                        </div>
                    {{ end }}
                </div>
            </div>
        </div>
    </div>
    <div class="clearfix"></div>

    {{ range $i, $sessionResult := .result.Result }}
        <a name={{ $sessionResult.DriverGUID }}></a>
        <div class="card mt-3 border-secondary">
            <div class="card-header">
                <strong>{{ add $i 1 }}{{ ordinal (add $i 1) }} {{ $sessionResult.DriverName }}
                {{ if eq $sessionResult.DriverGUID "76561198256908075" }} (Ey up you Southern twit){{ end }}</strong> in <strong>
                {{ prettify $sessionResult.CarModel true }}</strong>
            </div>
            <div class="card-body">

                <div class="row mt-3">
                    <div class="col-md-12">
                        <div class="table-responsive">
                            <table class="table table-bordered table-striped">
                                <tr>
                                    <th>Lap #</th>
                                    <th>Lap Time</th>

                                    {{ range $z, $null := $sessionResults.GetNumSectors }}
                                        <th>Sector {{ add $z 1 }}</th>
                                    {{ end }}

                                    <th>Cuts</th>
                                    <th>Tyre</th>
                                </tr>

                                {{ $lapCount := 0}}
                                {{ range $y, $sessionLap := $sessionResults.Laps }}
                                    {{ if eq $sessionLap.DriverGUID $sessionResult.DriverGUID }}
                                        {{ $lapCount = add $lapCount 1 }}
                                        <tr>
                                            <td>{{ $lapCount }}</td>
                                            <td>
                                                {{ $sessionLap.GetLapTime }}

                                                {{ if $sessionResults.IsFastestLap $sessionLap.LapTime }}
                                                    <div class="float-right mr-1">
                                                        <span data-toggle="tooltip" title="Fastest Lap" class="badge badge-success">L</span>
                                                    </div>
                                                {{ end }}

                                                {{ if $sessionResults.IsDriversFastestLap $sessionLap.DriverGUID $sessionLap.LapTime }}
                                                    <div class="float-right mr-1">
                                                        <span data-toggle="tooltip" title="Driver's Fastest Lap" class="badge badge-info">L</span>
                                                    </div>
                                                {{ end }}
                                            </td>

                                            {{ range $x, $null := $sessionResults.GetNumSectors }}
                                                <td>
                                                    {{ $sessionLap.GetSector $x }}

                                                    {{ if $sessionResults.IsFastestSector $x (index $sessionLap.Sectors $x) }}
                                                        <div class="float-right mr-1">
                                                            <span data-toggle="tooltip" title="Fastest Sector" class="badge badge-success">S</span>
                                                        </div>
                                                    {{ end }}

                                                    {{ if $sessionResults.IsDriversFastestSector $sessionLap.DriverGUID $x (index $sessionLap.Sectors $x) }}
                                                        <div class="float-right mr-1">
                                                            <span data-toggle="tooltip" title="Driver's Fastest Sector" class="badge badge-info">S</span>
                                                        </div>
                                                    {{ end }}
                                                </td>
                                            {{ end }}

                                            <td>{{ $sessionLap.Cuts }}</td>
                                            <td>{{ $sessionLap.Tyre }}</td>
                                        </tr>
                                    {{ end }}
                                {{ end }}
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="clearfix"></div>
    {{ end }}

{{ end }}
