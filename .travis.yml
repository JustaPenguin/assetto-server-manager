language: go

go:
  - 1.11

install:
  - git --version
  - go version

script:
  - export GO111MODULE=on
  - cd cmd/server-manager
  - cp config.example.yml config.yml
  - go get -u github.com/mjibson/esc
  - go generate ./...
  - GOOS=linux GOARCH=amd64 go build
  - GOOS=windows GOARCH=amd64 go build

deploy:
  provider: releases
  api_key: $OAUTH_TOKEN
  file:
    - server-manager
    - server-manager.exe
    - config.yml
  skip_cleanup: true
  on:
    tags: true