{{/* gotype: github.com/JustaPenguin/assetto-server-manager.RaceTemplateVars */}}

{{ define "title" }}
    {{ if .IsChampionship }}
        Championship Event
    {{ else if .IsRaceWeekend }}
        Race Weekend Session
    {{ else }}
        Custom Race
    {{ end }}
{{ end }}

{{ define "content" }}
    {{ $f := .Current }}
    {{ $trackInfo := trackInfo $f.Track $f.TrackLayout }}

    <h1 class="text-center">
        {{ if .IsChampionship }}
            Championship Event
        {{ else if .IsRaceWeekend }}
            Race Weekend Session
        {{ else }}
            Custom Race
        {{ end }}
    </h1>

    {{ if .IsChampionship }}
        <p>Configure an Event for the <strong>{{ .Championship.Name }}</strong> Championship.</p>
    {{ else if .IsRaceWeekend }}
        <p>Configure a Session for the <strong>{{ .RaceWeekend.Name }}</strong> Race Weekend.</p>
    {{ end }}

    <form class="race-setup"
          method="post"
          {{ if .IsChampionship }}
              action="/championship/{{ .Championship.ID.String }}/event/submit"
          {{ else if .IsRaceWeekend }}
              id="race-weekend-session"
              action="/race-weekend/{{ .RaceWeekend.ID.String }}/session/submit"
          {{ else }}
              action="/custom/new/submit"
          {{ end }}
          data-safe-submit
    >

        <div class="card mt-3 border-secondary">
            <div class="card-header">
                <strong>Track{{ if not (or .IsChampionship .IsRaceWeekend) }} & Cars {{ end }}</strong>

                {{ if .IsEditing }}
                    {{ if $.IsChampionship }}
                        <button class="btn btn-success float-right" name="action" value="saveChampionship" type="submit">Save Championship Event</button>
                    {{ else if $.IsRaceWeekend }}
                        <button class="btn btn-success float-right" name="action" value="saveRaceWeekend" type="submit">Save Race Weekend Session</button>
                    {{ else }}
                        <button type="submit" class="btn btn-success float-right" name="action" value="justSave">Save Race</button>
                    {{ end }}
                {{ end }}
            </div>

            <div class="card-body">
                <div class="row mb-5">
                    <div class="col-sm-8">
                        <div class="form-group row">
                            <label for="Track" class="col-sm-3 col-form-label">
                                Track
                            </label>

                            <div class="col-sm-9">
                                <select class="form-control" name="Track" id="Track">
                                    {{ range $index, $track := .TrackOpts }}
                                        <option value="{{ $track.Name }}" {{ if eq $track.Name $f.Track }}selected="selected" {{ end }}
                                                class="{{ if $track.IsPaidDLC }}bg-dlc{{ end }}{{ if $track.IsMod }}bg-mod{{ end }}">
                                            {{ prettify $track.Name false }}
                                        </option>
                                    {{ end }}
                                </select>

                                <small style="cursor: default;">
                                    <span class="badge bg-dlc">DLC</span>
                                    <span class="badge bg-mod">Mod</span>
                                </small>
                            </div>
                        </div>


                        <div class="form-group row" style="display: none;">
                            <label for="TrackLayout" class="col-sm-3 col-form-label">
                                Track Layout
                            </label>

                            <div class="col-sm-9">
                                <select class="form-control" name="TrackLayout" id="TrackLayout">
                                    {{ range $index, $track := .TrackOpts }}
                                        {{ range $layoutIndex, $layout := $track.Layouts }}
                                            {{ if and (eq $track.Name $f.Track) (eq $layout $f.TrackLayout) }}
                                                <option value="{{ $track.Name }}:{{ $layout }}:current">{{ $layout }}</option>
                                            {{ else }}
                                                <option value="{{ $track.Name }}:{{ $layout }}">{{ $layout }}</option>
                                            {{ end }}
                                        {{ end }}
                                    {{ end }}
                                </select>
                            </div>
                        </div>

                        {{ with $trackInfo }}
                            <div class="form-group row">
                                <label for="PitBoxes" class="col-sm-3 col-form-label">
                                    Pit Boxes
                                </label>

                                <div class="col-sm-9 pit-boxes">
                                    <span id="track-pitboxes">{{ $trackInfo.Pitboxes }}</span>
                                </div>

                                {{ with $.Championship }}
                                    <div class="col-sm-12">
                                        <span id="track-pitboxes-warning" class="text-warning mt-2"
                                            {{ if not (and ($.IsChampionship) (lt (int $.Championship.NumEntrants) (int $trackInfo.Pitboxes))) }} style="display: none;" {{ end }}
                                            >This track has fewer pit boxes than the configured number of entrants in the
                                            current {{if $.IsChampionship }}Championship{{ else }}Race{{end}}, and therefore is not eligible for it.</span>
                                    </div>
                                {{ end }}
                            </div>
                        {{ end }}
                    </div>

                    <div class="col-sm-4">
                        <img class="img img-fluid"
                             id="trackImage"
                             src="/content/tracks/{{ $f.Track }}/ui{{ with $f.TrackLayout }}/{{.}}{{ end }}/preview.png"
                             alt="{{ $f.Track }} {{ $f.TrackLayout }}"
                        >
                    </div>
                </div>

                <div class="form-group row">
                    {{ if not (or .IsChampionship .IsRaceWeekend) }}
                        <label for="Cars" class="col-sm-2 col-form-label">
                            Cars
                        </label>
                    {{ end }}
                    <div class="col-sm-10">
                        {{ if $.IsChampionship }}
                            <select multiple class="Cars" id="Cars" name="Cars" style="display: none;">
                                {{ range $index, $car := $.Championship.ValidCarIDs }}
                                    <option value="{{ $car }}" selected="selected">{{ prettify $car true }}</option>
                                {{ end }}
                            </select>
                        {{ else if $.IsRaceWeekend }}
                            <select multiple class="Cars" id="Cars" name="Cars" style="display: none;">
                                {{ with $.RaceWeekend.Championship }}
                                    {{ range $index, $car := $.RaceWeekend.Championship.ValidCarIDs }}
                                        <option value="{{ $car }}" selected="selected">{{ prettify $car true }}</option>
                                    {{ end }}
                                {{ else }}
                                    {{ range $index, $car := $.RaceWeekend.GetEntryList.CarIDs }}
                                        <option value="{{ $car }}" selected="selected">{{ prettify $car true }}</option>
                                    {{ end }}
                                {{ end }}
                            </select>
                        {{ else }}
                            {{ template "cars" dict "CarOpts" $.CarOpts "Current" $f }}
                        {{ end }}
                    </div>
                </div>
            </div>
        </div>

        {{ if and .IsChampionship .ChampionshipHasAtLeastOnceRace }}
            <div class="card mt-3 border-primary">
                <div class="card-header text-white bg-primary">
                    <strong>Save Championship Race</strong>
                </div>
                <div class="card-body">
                    <p>
                        The setup below this panel is identical to the previous race setup that you just configured.
                        This means that if you are happy with those settings, you can go on to create another race.

                        If not, feel free to scroll down and change the configuration of this race.
                    </p>

                    <p>
                        When this race is saved, it will be added to the <strong>{{ .Championship.Name }}</strong> Championship.
                        You can add more races below, or, if you're done creating the championship, you can complete its setup here.
                    </p>

                    <div class="float-right">
                        <button class="btn btn-primary mt-5" data-toggle="tooltip" name="action" value="addAnotherRace" type="submit" title="Save this setup and then configure another">Add another Race</button>
                        <button class="btn btn-success mt-5" data-toggle="tooltip" name="action" value="saveChampionship" type="submit" title="Save this race setup and finish creating the championship">Finish Creating Championship</button>
                    </div>
                </div>
            </div>
        {{ end }}


        <div class="card mt-3 border-secondary">
            <div class="card-header">
                <strong>Session{{ if not $.IsRaceWeekend }}s{{ end }}</strong>
            </div>

            <div class="card-body">

                {{ if $.IsPremium }}
                    <div class="form-group row" {{ if or $.IsRaceWeekend .IsChampionship }} style="display: none" {{ end }}>
                        <label class="col-sm-3 col-form-label">Time Attack</label>

                        <div class="col-sm-9">
                            <input
                                    type="checkbox"
                                    class="session-enabler"
                                    name="TimeAttack"
                                    id="TimeAttack"

                                    {{ if $f.TimeAttack }}
                                        checked="checked"
                                    {{ end }}
                            >

                            <br><br>
                            <small>Time Attack events will run a looping Practice session and combine all of the results files.
                            Forces loop mode on and disables all sessions other than Practice.</small>
                        </div>
                    </div>
                {{ end }}

                {{ if $.IsRaceWeekend }}
                    <div class="form-group row">
                        <label for="SessionType" class="col-sm-3 col-form-label">Session Type</label>

                        <div class="col-sm-9">
                            <select name="SessionType" id="SessionType" class="form-control">


                                {{ range $index, $sessionType := .AvailableSessions }}
                                    {{ $hasSession := $f.HasSession $sessionType }}

                                    <option value="{{ $sessionType }}" {{ if $hasSession }}selected="selected"{{ end }}>
                                        {{ $sessionType.String }}
                                    </option>
                                {{ end }}
                            </select>
                        </div>
                    </div>

                    <hr>
                {{ else }}
                    <ul class="nav nav-tabs" role="tablist">
                        {{ range $index, $sessionType := .AvailableSessions }}

                            {{ $hasSession := $f.HasSession $sessionType }}

                            <li class="nav-item">
                                <a class="nav-link session-nav-link {{ if eq $index 0 }}active{{ end }} {{ if $hasSession }} text-success {{ end }}" id="session-{{ $sessionType }}-tab"
                                   data-toggle="tab" href="#session-{{ $sessionType }}"
                                   role="tab"
                                   aria-controls="{{ $sessionType }}" aria-selected="true">{{ $sessionType.String }}</a>
                            </li>
                        {{ end }}
                    </ul>
                {{ end }}


                <div class="tab-content sessions">
                    {{ range $index, $sessionType := .AvailableSessions }}
                        {{ $hasSession := $f.HasSession $sessionType }}
                        {{ $session := $f.GetSession $sessionType }}

                        <div class="tab-pane fade  {{ if not $.IsRaceWeekend }} {{ if eq $index 0 }}show active{{ end }} pt-5 {{ else if $hasSession }} show active {{ end }}"
                             id="session-{{ $sessionType }}" role="tabpanel"
                             aria-labelledby="session-{{ $sessionType }}-tab">


                            <div class="form-group row" {{ if $.IsRaceWeekend }} style="display: none" {{ end }}>
                                <label class="col-sm-3 col-form-label">Enabled</label>

                                <div class="col-sm-9">
                                    <input
                                            type="checkbox"
                                            class="session-enabler"
                                            name="{{ $sessionType }}.Enabled"
                                            id="{{ $sessionType }}.Enabled"

                                            {{ if $hasSession }}
                                            checked="checked"
                                            {{ end }}
                                    >

                                    {{ if eq $sessionType "BOOK" }}
                                        <br><br>
                                        <small>Enabling Booking Mode means that you cannot configure a specific EntryList. The server will start with Pickup mode disabled and Entrants must choose their car and livery during the Booking session time.</small>
                                    {{ end }}
                                </div>
                            </div>

                            <div class="session-details" {{ if not $hasSession }} style="display: none;" {{ end }}>
                                <div class="form-group row">
                                    <label for="{{ $sessionType }}.Name" class="col-sm-3 col-form-label">Name</label>

                                    <div class="col-sm-9">
                                        <input type="text" id="{{ $sessionType }}.Name" name="{{ $sessionType }}.Name"
                                               class="form-control" value="{{ with $session.Name }}{{ . }}{{ else }}{{ $sessionType.String }}{{ end }}">

                                        <small></small>
                                    </div>
                                </div>


                                {{ if eq $sessionType "RACE" }}
                                    <div class="form-group row">
                                        <div class="col-sm-3">
                                            <select id="TimeOrLaps" class="form-control">
                                                <option value="Time" {{ if or (ne $session.Time 0) (eq $session.Laps 0) }} selected="selected" {{ end }}>Time</option>
                                                <option value="Laps" {{ if ne $session.Laps 0 }} selected="selected" {{ end }}>Laps</option>
                                            </select>
                                        </div>

                                        <div class="col-sm-9" id="RaceTime" {{ if not (or (ne $session.Time 0) (eq $session.Laps 0)) }}style="display: none;"{{ end }}>
                                            <input
                                                    type="number"
                                                    id="Race.Time"
                                                    name="Race.Time"
                                                    class="form-control"
                                                    {{ if and (eq $session.Time 0) (eq $session.Laps 0) }}
                                                        value="15"
                                                    {{ else }}
                                                        value="{{ $session.Time }}"
                                                    {{ end }}


                                                    step="1"
                                            >

                                            <small>Session length in minutes</small>
                                        </div>


                                        <div class="col-sm-9" id="RaceLaps" {{ if eq $session.Laps 0 }}style="display: none;"{{ end }}>
                                            <input
                                                    type="number"
                                                    id="Race.Laps"
                                                    name="Race.Laps"
                                                    class="form-control"
                                                    value="{{ $session.Laps }}"


                                                    step="1"
                                            >

                                            <small>Number of laps in the race</small>
                                        </div>
                                    </div>
                                {{ else }}
                                    <div class="form-group row">
                                        <label for="{{ $sessionType }}.Time"
                                               class="col-sm-3 col-form-label">Time</label>


                                        <div class="col-sm-9">
                                            <input
                                                    type="number"
                                                    id="{{ $sessionType }}.Time"
                                                    name="{{ $sessionType }}.Time"
                                                    class="form-control"
                                                    value="{{ with $session.Time }}{{ . }}{{ else }}15{{ end }}"
                                                    step="1"
                                            >

                                            <small>Session length in minutes</small>
                                        </div>
                                    </div>

                                {{ end }}

                                {{ if and (ne $sessionType "BOOK") (not $.IsRaceWeekend) }}

                                    <div class="form-group row">
                                        <label for="{{ $sessionType }}.IsOpen" class="col-sm-3 col-form-label">
                                            Is Open
                                        </label>
                                            <div class="col-sm-9">
                                                <select class="form-control"
                                                        id="{{ $sessionType }}.IsOpen"
                                                        name="{{ $sessionType }}.IsOpen"
                                                >
                                                    <option value="0" {{ if eq $session.IsOpen 0 }} selected="selected" {{ end }}>No join</option>
                                                    <option value="1" {{ if eq $session.IsOpen 1 }} selected="selected" {{ end }}>Free join</option>

                                                    {{ if eq $sessionType "RACE" }}
                                                        <option value="2" {{ if eq $session.IsOpen 2 }} selected="selected" {{ end }}>
                                                            Free join until 20 seconds to the green light
                                                        </option>
                                                    {{ end }}
                                                </select>

                                                <small>Allow joining during a session, the first session of an event should not be set to
                                                 no join, although subsequent ones can be in order to only allow drivers from the previous
                                                     session to connect.</small>
                                            </div>
                                    </div>

                                {{ end }}

                                {{ if eq $sessionType "RACE" }}

                                    <div class="form-group row">
                                        <label for="{{ $sessionType }}.WaitTime" class="col-sm-3 col-form-label">
                                            Wait Time
                                        </label>

                                        <div class="col-sm-9">
                                            <input
                                                    type="number"
                                                    id="{{ $sessionType }}.WaitTime"
                                                    name="{{ $sessionType }}.WaitTime"
                                                    class="form-control"
                                                    value="{{ if and $.IsRaceWeekend (lt $session.WaitTime 120) }}120{{ else }}{{ $session.WaitTime }}{{ end }}"


                                                    step="1"
                                            >

                                            <small>Seconds before the start of the session</small>
                                        </div>
                                    </div>

                                {{ end }}


                                {{ if eq $sessionType "RACE" }}
                                    <hr>

                                    <div class="row">

                                        <div class="form-group row col-md-6">
                                            <label for="RacePitWindowStart" class="col-sm-6 col-form-label">Race Pit Window Start</label>

                                            <div class="col-sm-6">
                                                <input
                                                        type="number"
                                                        id="RacePitWindowStart"
                                                        name="RacePitWindowStart"
                                                        class="form-control"
                                                        value="{{ $f.RacePitWindowStart }}"


                                                        step="1"
                                                >

                                                <small>Pit window opens at lap/minute specified</small>
                                            </div>
                                        </div>


                                        <div class="form-group row col-md-6">
                                            <label for="RacePitWindowEnd" class="col-sm-6 col-form-label">Race Pit Window End</label>

                                            <div class="col-sm-6">
                                                <input
                                                        type="number"
                                                        id="RacePitWindowEnd"
                                                        name="RacePitWindowEnd"
                                                        class="form-control"
                                                        value="{{ $f.RacePitWindowEnd }}"


                                                        step="1"
                                                >

                                                <small>Pit window closes at lap/minute specified</small>
                                            </div>
                                        </div>

                                    </div>

                                    <div class="row">
                                        <div class="form-group row col-md-6">
                                            <label for="RaceOverTime" class="col-sm-6 col-form-label">Race Over Time</label>

                                            <div class="col-sm-6">
                                                <input
                                                        type="number"
                                                        id="RaceOverTime"
                                                        name="RaceOverTime"
                                                        class="form-control"
                                                        value="{{ $f.RaceOverTime }}"
                                                        min="0"

                                                        step="1"
                                                >

                                                <small>
                                                    Time remaining in seconds to finish the race from the moment the first one passes on the finish line
                                                </small>
                                            </div>
                                        </div>


                                        <div class="form-group row col-md-6">
                                            <label for="RaceGasPenaltyDisabled" class="col-sm-6 col-form-label">
                                                Race Gas Penalty
                                            </label>


                                            <div class="col-sm-6">
                                                <input
                                                        type="checkbox"
                                                        id="RaceGasPenaltyDisabled"
                                                        name="RaceGasPenaltyDisabled"
                                                        {{ if not $f.RaceGasPenaltyDisabled }}
                                                            checked="checked"
                                                        {{ end }}
                                                >
                                                <br>

                                                <small>
                                                    OFF: no penalization will be  forced, but cuts will be saved in the race result json.<br>
                                                    ON: any cut will be penalized with the gas cut message.
                                                </small>
                                            </div>
                                        </div>

                                    </div>

                                    <hr>

                                    {{ if not $.IsRaceWeekend }}
                                        <div class="form-group row col-md-12">
                                            <label for="ReversedGridRacePositions" class="col-sm-3 col-form-label" data-toggle="tooltip" title="The race session will be restarted in reversed grid order based on the standings of the previous race. Players disqualified in the first race will start from the back of the grid in the second race, regardless of their position being within the reversed grid range.">
                                                Reversed Grid Race Positions
                                            </label>

                                            <div class="col-sm-9">
                                                <input
                                                        type="number"
                                                        id="ReversedGridRacePositions"
                                                        name="ReversedGridRacePositions"
                                                        class="form-control"
                                                        value="{{ $f.ReversedGridRacePositions }}"


                                                        step="1"
                                                >

                                                <small> 0 = no additional race<br/>
                                                    -1 = all the positions will be reversed (Retired players will be on the last positions)<br/>
                                                    1 = A 2nd Race will take place with the grid formed from the 1st Race's results<br/>
                                                    X = first X number of positions will be reversed for the 2nd race
                                                </small>
                                            </div>
                                        </div>

                                        {{ with  $.Championship }}
                                            {{ if and $.IsChampionship $.Championship.ACSR }}
                                                <div class="form-group row col-md-12">
                                                    <label for="ExportSecondRaceToACSR" class="col-sm-3 col-form-label">Export 2nd Race to ACSR</label>


                                                    <div class="col-sm-9">
                                                        <input type="checkbox"
                                                               id="ExportSecondRaceToACSR"
                                                               name="ExportSecondRaceToACSR"
                                                               value="{{ $f.ExportSecondRaceToACSR }}"

                                                                {{ if $f.ExportSecondRaceToACSR }}
                                                                    checked="checked"
                                                                {{ end }}
                                                        >

                                                        <br>

                                                        <small>The second race can be optionally exported to ACSR as well as the first race.</small>
                                                    </div>
                                                </div>
                                            {{ end }}
                                        {{ end }}
                                    {{ end }}

                                    <div class="form-group row col-md-12 race-extra-lap" {{ if and (eq $session.Time 0) (ne $session.Laps 0) }} style="display: none;" {{ end }}>
                                        <label for="RaceExtraLap" class="col-sm-3 col-form-label">Extra Lap</label>


                                        <div class="col-sm-9">
                                            <input
                                                    type="checkbox"
                                                    id="RaceExtraLap"
                                                    name="RaceExtraLap"
                                                    {{ if $f.RaceExtraLap }}
                                                        checked="checked"
                                                    {{ end }}
                                            >
                                            <br>

                                            <small>
                                                If the race is timed, force an extra lap after the leader has crossed the line
                                            </small>
                                        </div>
                                    </div>
                                {{ else if eq $sessionType "QUALIFY" }}
                                    <hr>

                                    <div class="form-group row">
                                        <label for="QualifyMaxWaitPercentage" class="col-sm-3 col-form-label">Qualify Max Wait
                                            Percentage</label>

                                        <div class="col-sm-9">
                                            <input
                                                    type="number"
                                                    id="QualifyMaxWaitPercentage"
                                                    name="QualifyMaxWaitPercentage"
                                                    class="form-control"
                                                    value="{{ $f.QualifyMaxWaitPercentage }}"


                                                    step="1"
                                            >

                                            <small>The factor to calculate the remaining time in a qualify session after the session is
                                                ended: 120
                                                means that 120% of the session fastest lap remains to end the current lap.
                                            </small>
                                        </div>
                                    </div>
                                {{ end }}


                            </div>
                        </div>
                    {{ end }}
                </div>
            </div>
        </div>


        <div class="card mt-3 border-secondary">
            <div class="card-header">
                <strong>Entry List</strong>
            </div>

            <div class="card-body" id="entrants">
                {{ if not $.IsRaceWeekend }}
                    <div class="form-group row {{ if .IsChampionship }}visible-booking-enabled{{ end }}" {{ if and .IsChampionship (not ($f.HasSession "BOOK")) }}style="display: none;"{{ end }}>
                        <label for="MaxClients" class="col-sm-3 col-form-label">Max Clients</label>

                        <div class="col-sm-9">
                                <input
                                        type="number"
                                        id="MaxClients"
                                        name="MaxClients"
                                        class="form-control"

                                        {{ if gt $.MaxClientsOverride 0 }}
                                            data-value-override="{{ $.MaxClientsOverride }}"
                                            value="{{ $.MaxClientsOverride }}"

                                            max="{{ $.MaxClientsOverride }}"
                                        {{ else }}
                                            value="{{ $f.MaxClients }}"
                                            {{ with $trackInfo }}max="{{ $trackInfo.Pitboxes }}"{{ end }}
                                        {{ end }}
                                        step="1"
                                >

                            <small>
                                Maximum number of clients allowed on the server.

                                {{ if gt $.MaxClientsOverride 0 }}
                                    <strong>Cannot be greater than {{ $.MaxClientsOverride }}</strong>. (This value is restricted by your hosting provider.)<br>
                                {{ end }}
                            </small>
                        </div>
                    </div>

                    {{ if not .IsChampionship }}
                        <div class="hidden-booking-enabled">

                            <div class="form-group row">
                                <label for="PickupModeEnabled" class="col-sm-3 col-form-label">Pickup Mode</label>


                                <div class="col-sm-9">
                                    <input type="checkbox"
                                           id="PickupModeEnabled"
                                           name="PickupModeEnabled"
                                           value="{{ $f.PickupModeEnabled }}"

                                            {{ if eq $f.PickupModeEnabled 1 }}
                                                checked="checked"
                                            {{ end }}
                                    >

                                    <br>

                                    <small>
                                        If set to OFF the server starts in booking mode. Warning: in pickup mode you have to
                                        list at least one car in the entry list. Note, when Pickup Mode is OFF, sessions
                                        with Loop Mode ON or Reversed Grid Positions will require players to rejoin the server
                                        when the server loops or progresses to a second race.
                                    </small>
                                </div>
                            </div>

                            <div class="form-group row">
                                <label for="LockedEntryList" class="col-sm-3 col-form-label">Locked Entry List</label>


                                <div class="col-sm-9">
                                    <input type="checkbox"
                                           id="LockedEntryList"
                                           name="LockedEntryList"
                                           value="{{ $f.LockedEntryList }}"

                                            {{ if eq $f.LockedEntryList 1 }}
                                                checked="checked"
                                            {{ end }}
                                    >

                                    <br>

                                    <small>Only players already included in the entry list can join the server.</small>

                                    <small id="locked-reverse-warning" class="text-danger">The server will crash if
                                    a second race is active (Reverse Grid Race Positions != 0), locked entry list is on
                                    and pickup mode is off. In order to turn on locked entry list for this event turn on
                                    pickup mode too!</small>
                                </div>
                            </div>

                            <div id="entrantTemplate" class="entrant">
                                {{ template "entrant" }}
                            </div>

                        </div>
                    {{ end }}

                    {{ if and $.IsPremium (not $.IsChampionship) }}
                        <hr>
                    {{ end }}
                {{ end }}

                {{ if $.IsPremium }}
                    <div class="form-group row">
                        <label for="DriverSwapEnabled" class="col-sm-3 col-form-label">Driver Swaps</label>


                        <div class="col-sm-9">
                            <input type="checkbox"
                                   id="DriverSwapEnabled"
                                   name="DriverSwapEnabled"
                                   value="{{ $f.DriverSwapEnabled }}"

                                    {{ if eq $f.DriverSwapEnabled 1 }}
                                        checked="checked"
                                    {{ end }}
                            >

                            <br>
                            <small>
                                Server Manager Driver Swaps will allow multiple drivers in one entrant who can perform driver swaps. Add multiple GUIDs separated by ;'s to an entrant to allow this.
                                <strong>
                                    Note: Driver Swaps will only yield valid results files if the timing line for a track is before or after all of the pitboxes.
                                </strong>

                                Follow this <a href="https://github.com/JustaPenguin/assetto-server-manager/wiki/Driver-swap-track-editing">guide on how to edit tracks to work with Driver Swaps</a>.
                            </small>
                        </div>
                    </div>


                    <div class="visible-driver-swap-enabled">
                        <div class="form-group row">
                            <label for="DriverSwapMinTime" class="col-sm-3 col-form-label">Minimum Driver Swap Time (seconds)</label>

                            <div class="col-sm-9">
                                <input
                                        type="number"
                                        id="DriverSwapMinTime"
                                        name="DriverSwapMinTime"
                                        class="form-control"
                                        value="{{ $f.DriverSwapMinTime }}"
                                        step="1"
                                >

                                <small>
                                    Minimum time for a driver swap, used to avoid giving users with faster computers an advantage. If the second driver sets off before this time they will be disqualified/given a penalty based on configuration.
                                </small>
                            </div>
                        </div>

                        <div class="form-group row">
                            <label for="DriverSwapDisqualifyTime" class="col-sm-3 col-form-label">Driver Swap Disqualification Window (seconds)</label>

                            <div class="col-sm-9">
                                <input
                                        type="number"
                                        id="DriverSwapDisqualifyTime"
                                        name="DriverSwapDisqualifyTime"
                                        class="form-control"
                                        value="{{ $f.DriverSwapDisqualifyTime }}"
                                        step="1"
                                >

                                <small>
                                    Driver will be kicked from the race and disqualified if they set off this many seconds or more before the minimum time during a Driver Swap.
                                </small>
                            </div>
                        </div>

                        <div class="form-group row">
                            <label for="DriverSwapPenaltyTime" class="col-sm-3 col-form-label">Driver Swap Penalty Window (seconds)</label>

                            <div class="col-sm-9">
                                <input
                                        type="number"
                                        id="DriverSwapPenaltyTime"
                                        name="DriverSwapPenaltyTime"
                                        class="form-control"
                                        value="{{ $f.DriverSwapPenaltyTime }}"
                                        step="1"
                                >

                                <small>
                                    If a driver sets off this many seconds or more before the minimum time during a Driver Swap,
                                    they will be given a penalty equal to the number of seconds left in the countdown plus 5 seconds.
                                </small>
                            </div>
                        </div>

                        <div class="form-group row">
                            <label for="DriverSwapMinimumNumberOfSwaps" class="col-sm-3 col-form-label">Minimum Number Of Driver Swaps</label>

                            <div class="col-sm-9">
                                <input
                                        type="number"
                                        id="DriverSwapMinimumNumberOfSwaps"
                                        name="DriverSwapMinimumNumberOfSwaps"
                                        class="form-control"
                                        value="{{ $f.DriverSwapMinimumNumberOfSwaps }}"
                                        step="1"
                                >

                                <small>
                                    The number of swaps that a driver must complete. If they do not complete the required number of stops, they are penalised (see below).
                                </small>
                            </div>
                        </div>

                        <div class="form-group row">
                            <label for="DriverSwapNotEnoughSwapsPenalty" class="col-sm-3 col-form-label">Not Enough Driver Swaps Penalty (seconds)</label>

                            <div class="col-sm-9">
                                <input
                                        type="number"
                                        id="DriverSwapNotEnoughSwapsPenalty"
                                        name="DriverSwapNotEnoughSwapsPenalty"
                                        class="form-control"
                                        value="{{ $f.DriverSwapNotEnoughSwapsPenalty }}"
                                        step="1"
                                >

                                <small>
                                    The penalty in seconds that is applied to a driver for each Driver Swap under the required minimum that they missed. If set to 0, the driver is disqualified.
                                </small>
                            </div>
                        </div>

                    </div>

                    <br>
                {{ end }}

                {{ if not $.IsRaceWeekend }}
                    <div class="hidden-booking-enabled">

                        <div class="entrants-block">
                            {{ range $index, $entrant := .CurrentEntrants.AsSlice }}
                                <div class="entrant">
                                    {{ template "entrant" dict "Entrant" $entrant "IsChampionshipEvent" $.IsChampionship }}
                                </div>
                            {{ else }}
                                <div class="entrant">
                                    {{ template "entrant" }}
                                </div>
                            {{ end }}
                        </div>


                        {{ if not .IsChampionship }}
                            <div class="row">
                                <div class="col-md-8 pt-2">
                                    <p>Car, Skin, Ballast, Restrictor and Fixed Setup from the last Entrant will be cloned into new Entrants.</p>
                                </div>
                                <div class="col-md-4 text-right">
                                    <input class="form-control numEntrantsToAdd" type="number" name="NumEntrantsToAdd" value="1" min="0">

                                    <button class="btn btn-warning addEntrant">Add Entrant(s)</button>
                                </div>
                            </div>
                        {{ end }}

                    </div>

                    <div class="visible-booking-enabled">
                        <p>Booking Mode is enabled. You cannot configure specific drivers in the EntryList. Pickup Mode will be disabled.</p>
                    </div>

                    <input type="hidden" class="totalNumEntrants" name="EntryList.NumEntrants" value="{{ if gt 0 (len .CurrentEntrants) }}{{ len .CurrentEntrants }}{{ else }}1{{ end }}">
                {{ end }}

                <div class="clearfix"></div>
            </div>
        </div>

        <div class="card mt-3 border-secondary">
            <div class="card-header">
                <strong>Assists</strong>
            </div>

            <div class="card-body">

                <div class="form-group row">
                    <label for="ABSAllowed" class="col-sm-3 col-form-label">ABS Allowed</label>

                    <div class="col-sm-9">
                        <select class="form-control" id="ABSAllowed" name="ABSAllowed">
                            <option value="0" {{ if eq $f.ABSAllowed 0 }} selected="selected" {{ end }}>Off</option>
                            <option value="1" {{ if eq $f.ABSAllowed 1 }} selected="selected" {{ end }}>Factory</option>
                            <option value="2" {{ if eq $f.ABSAllowed 2 }} selected="selected" {{ end }}>On</option>
                        </select>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="TractionControlAllowed" class="col-sm-3 col-form-label">
                        Traction Control Allowed
                    </label>

                    <div class="col-sm-9">
                        <select class="form-control" id="TractionControlAllowed" name="TractionControlAllowed">
                            <option value="0" {{ if eq $f.TractionControlAllowed 0 }} selected="selected" {{ end }}>Off</option>
                            <option value="1" {{ if eq $f.TractionControlAllowed 1 }} selected="selected" {{ end }}>Factory</option>
                            <option value="2" {{ if eq $f.TractionControlAllowed 2 }} selected="selected" {{ end }}>On</option>
                        </select>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="StabilityControlAllowed" class="col-sm-3 col-form-label">
                        Stability Control Allowed
                    </label>

                    <div class="col-sm-9">
                        <input type="checkbox"
                               id="StabilityControlAllowed"
                               name="StabilityControlAllowed"
                            {{ if $f.StabilityControlAllowed }}
                                checked="checked"
                            {{ end }}
                        >
                        <br>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="AutoClutchAllowed" class="col-sm-3 col-form-label">Auto Clutch Allowed</label>


                    <div class="col-sm-9">
                        <input type="checkbox"
                               id="AutoClutchAllowed"
                               name="AutoClutchAllowed"
                               {{ if $f.AutoClutchAllowed }}
                                   checked="checked"
                               {{ end }}
                        >
                        <br>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="TyreBlanketsAllowed" class="col-sm-3 col-form-label">Tyre Blankets Allowed</label>


                    <div class="col-sm-9">
                        <input type="checkbox"
                               id="TyreBlanketsAllowed"
                               name="TyreBlanketsAllowed"

                               {{ if $f.TyreBlanketsAllowed }}
                                   checked="checked"
                               {{ end }}
                        >
                        <br>

                        <small>
                            At the start of the session or after a pitstop, tyres will have the the optimal temperature.
                        </small>
                    </div>
                </div>

            </div>
        </div>


        <div class="card mt-3 border-secondary">
            <div class="card-header">
                <strong>Weather</strong>
            </div>

            <div class="card-body">

                <div class="form-group row">
                    <label class="col-sm-3 col-form-label">Sol Integration</label>

                    <div class="col-sm-9">
                        {{ if .SolIsInstalled }}
                            <input
                                    type="checkbox"
                                    class="sol-enabler"
                                    name="Sol.Enabled"
                                    id="Sol.Enabled"

                                    {{ if $f.IsSol }}
                                        checked="checked"
                                    {{ end }}
                            >

                            <br>
                            <small>Allows for 24 hour time cycles. The server treats time differently if enabled. Clients also require Sol and Content Manager</small>
                        {{ else }}
                            <p class="text-danger">Sol isn't installed. Please <a href="/weather">upload your Sol weathers</a> if you want to use Sol.</p>
                        {{ end }}
                    </div>
                </div>

                <div class="not-sol-settings" {{ if $f.IsSol }} style="display: none;" {{ end }}>


                    <div class="form-group row">
                        <label for="SunAngle" class="col-sm-3 col-form-label">Time Of Day</label>

                        <div class="col-sm-9">
                            <input
                                    type="time"
                                    id="TimeOfDay"
                                    name="TimeOfDay"
                                    class="form-control"
                                    value="16:00"
                            >

                            <small>Used to calculate the Sun Angle (below)</small>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="SunAngle" class="col-sm-3 col-form-label">Sun Angle</label>

                        <div class="col-sm-9">
                            <input
                                    type="number"
                                    id="SunAngle"
                                    name="SunAngle"
                                    class="form-control"
                                    value="{{ $f.SunAngle }}"


                                    step="1"
                            >

                            <small>Angle of the position of the sun</small>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="TimeOfDayMultiplier" class="col-sm-3 col-form-label">Time Of Day Multiplier</label>

                        <div class="col-sm-9">
                            <input
                                    type="number"
                                    id="TimeOfDayMultiplier"
                                    name="TimeOfDayMultiplier"
                                    class="form-control"
                                    value="{{ $f.TimeOfDayMultiplier }}"
                                    min="0"
                                    step="1"
                            >

                            <small>Multiplier for the time of day</small>
                        </div>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="WindBaseSpeedMin" class="col-sm-3 col-form-label">Wind Base Speed Min</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="WindBaseSpeedMin"
                                name="WindBaseSpeedMin"
                                class="form-control"
                                value="{{ $f.WindBaseSpeedMin }}"
                                min="0"
                                step="1"
                        >

                        <small>Min speed of the session possible</small>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="WindBaseSpeedMax" class="col-sm-3 col-form-label">Wind Base Speed Max</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="WindBaseSpeedMax"
                                name="WindBaseSpeedMax"
                                class="form-control"
                                value="{{ $f.WindBaseSpeedMax }}"
                                max="40"

                                step="1"
                        >

                        <small>Max speed of session possible (max 40)</small>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="WindBaseDirection" class="col-sm-3 col-form-label">Wind Base Direction</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="WindBaseDirection"
                                name="WindBaseDirection"
                                class="form-control"
                                value="{{ $f.WindBaseDirection }}"


                                step="1"
                        >

                        <small>Base direction of the wind (wind is pointing at); 0 = North, 90 = East etc</small>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="WindVariationDirection" class="col-sm-3 col-form-label">Wind Variation Direction</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="WindVariationDirection"
                                name="WindVariationDirection"
                                class="form-control"
                                value="{{ $f.WindVariationDirection }}"


                                step="1"
                        >

                        <small>Variation (&#43; or -) of the base direction</small>
                    </div>
                </div>

                <hr>

                <p>Each new session will <strong>randomly select</strong> its weather configuration from the below options.</p>

                <div class="row">

                    {{ $weatherIndex := 0 }}
                    {{ $weatherOptions := .Weather }}

                    {{ range $index, $weather := $f.Weather }}

                        <div class="col-sm-12 weather">
                            <div class="card mb-5 border-primary">
                                <div class="card-header">
                                    <strong class="weather-num">{{ $weatherIndex }}</strong>

                                    <a href="#"
                                       class="float-right text-danger weather-delete"
                                       title="Delete this Weather"
                                       {{ if eq $weatherIndex 0 }}
                                           style="display: none;"
                                       {{ end }}
                                    >
                                        <i class="fa fa-trash"></i>
                                    </a>
                                </div>

                                <div class="card-body row">

                                    <div class="col-sm-7">

                                        <div class="sol-settings" {{ if not $f.IsSol }} style="display: none;" {{ end }}>

                                            <div class="form-group row">
                                                <label class="col-sm-3 col-form-label col-form-label-sm">Session Start Date/Time</label>

                                                <div class="col-sm-9 p-0" id='date-time-picker'>
                                                    <input
                                                            type='datetime-local'
                                                            id="DateUnix"
                                                            name="DateUnix"
                                                            class="form-control"
                                                            {{ if gt $weather.CMWFXDateUnModified 0 }}
                                                                value="{{ dateInZone "2006-01-02T15:04" ($weather.UnixToTime $weather.CMWFXDateUnModified) "UTC" }}"
                                                            {{ else }}
                                                                value="{{ dateInZone "2006-01-02T15:04" now "UTC" }}"
                                                            {{ end }}
                                                    >
                                                </div>
                                            </div>

                                            <div class="form-group row">
                                                <label class="col-sm-3 col-form-label col-form-label-sm">Time Progression Multiplier</label>

                                                <div class="col-sm-9 p-0">
                                                    <input
                                                            type="number"
                                                            id="TimeMulti"
                                                            name="TimeMulti"
                                                            class="form-control"
                                                            value="{{ $weather.CMWFXTimeMulti }}"
                                                            step="1"
                                                    >

                                                    <small>E.g. at 60x 24 hours in game will pass in 24 minutes real time</small>
                                                </div>
                                            </div>

                                        </div>

                                        <div class="form-group row">
                                            <label class="col-sm-3 col-form-label col-form-label-sm" for="Graphics">Graphics</label>

                                            <select name="Graphics" id="Graphics" class="form-control form-control-sm weather-graphics col-sm-9">
                                                {{ range $weatherKey, $weatherName := $weatherOptions }}
                                                    <option value="{{ $weatherKey }}" {{ if eq $weatherKey ($weather.TrimName $weather.Graphics) }} selected="selected" {{ end }}>
                                                        {{ $weatherName }}
                                                    </option>
                                                {{ end }}
                                            </select>
                                        </div>

                                        <div class="form-group row {{ if not $.IsChampionship }}d-none{{ end }}">
                                            <label class="col-sm-3 col-form-label col-form-label-sm" for="ChampionshipPracticeWeather">Championship Weather Context</label>

                                            <div class="col-sm-9 p-0">
                                                <select name="ChampionshipPracticeWeather" id="ChampionshipPracticeWeather"
                                                        class="form-control form-control-sm"
                                                        {{ if not $.IsChampionship }}readonly="readonly"{{ end }}>

                                                    <option value="weatherAny" {{ if and $.IsChampionship (eq $weather.ChampionshipPracticeWeather "weatherAny") }} selected="selected" {{ end }}>
                                                        Any Session
                                                    </option>
                                                    <option value="weatherPractice" {{ if and $.IsChampionship (eq $weather.ChampionshipPracticeWeather "weatherPractice") }} selected="selected" {{ end }}>
                                                        Championship Practice Only
                                                    </option>
                                                    <option value="weatherEvent" {{ if and $.IsChampionship (eq $weather.ChampionshipPracticeWeather "weatherEvent") }} selected="selected" {{ end }}>
                                                        Championship Event Only
                                                    </option>
                                                </select>

                                                <small>Select whether weather will be used for only Championship practice sessions (started from the Championship overview page),
                                                only actual championship events, or any session</small>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="form-group col-sm-6">
                                                <label><small>Base Temperature Ambient</small></label>
                                                <input
                                                        type="number"
                                                        id="BaseTemperatureAmbient"
                                                        name="BaseTemperatureAmbient"
                                                        class="form-control form-control-sm"
                                                        value="{{ $weather.BaseTemperatureAmbient }}"


                                                        step="1"
                                                >
                                            </div>


                                            <div class="form-group col-sm-6">
                                                <label><small>Base Temperature Road</small></label>
                                                <input
                                                        type="number"
                                                        id="BaseTemperatureRoad"
                                                        name="BaseTemperatureRoad"
                                                        class="form-control form-control-sm"
                                                        value="{{ $weather.BaseTemperatureRoad }}"


                                                        step="1"
                                                >

                                                <small>This value will be added to the final ambient
                                                    temp. Value can be negative.
                                                </small>
                                            </div>
                                        </div>


                                        <div class="row">
                                            <div class="form-group col-sm-6">
                                                <label><small>Variation Ambient</small></label>

                                                <input
                                                        type="number"
                                                        id="VariationAmbient"
                                                        name="VariationAmbient"
                                                        class="form-control form-control-sm"
                                                        value="{{ $weather.VariationAmbient }}"


                                                        step="1"
                                                >

                                                <small>Variation of the ambient&#39;s temperature. In this example final ambient&#39;s
                                                    temperature can be 16 or 20
                                                </small>
                                            </div>


                                            <div class="form-group col-sm-6">
                                                <label><small>Variation Road</small></label>

                                                <input
                                                        type="number"
                                                        id="VariationRoad"
                                                        name="VariationRoad"
                                                        class="form-control form-control-sm"
                                                        value="{{ $weather.VariationRoad }}"


                                                        step="1"
                                                >

                                                <small>Variation of the road&#39;s temperature. Like the ambient one</small>
                                            </div>
                                        </div>
                                    </div>


                                    <div class="col-sm-5">
                                        <img class="img img-fluid weather-preview mb-3" src="/content/weather/{{ $weather.TrimName $weather.Graphics }}/preview.jpg" alt="{{ $weather.TrimName $weather.Graphics }}">
                                    </div>

                                </div>
                            </div>
                        </div>

                        {{ $weatherIndex = add $weatherIndex 1 }}
                    {{ end }}
                </div>

                <button class="btn btn-primary float-right" id="addWeather">Add Weather</button>

                <div class="clearfix mb-5"></div>

            </div>

        </div>


        <div class="card mt-3 border-secondary">
            <div class="card-header">
                <strong>Realism</strong>
            </div>

            <div class="card-body">


                <div class="form-group row legal-tyres">
                    <label for="LegalTyres" class="col-sm-3 col-form-label">Legal Tyres</label>

                    {{ $allTyres := .Tyres }}

                    <div class="col-sm-9">
                        <select multiple class="form-control" id="LegalTyres" name="LegalTyres">
                            {{ range $index, $tyre := varSplit $f.LegalTyres }}
                                <option value="{{ $tyre }}" selected="selected">{{ prettify ($allTyres.Name $tyre (varSplit $f.Cars)) false }} ({{ $tyre }})</option>
                            {{ end }}

                            {{ range $tyre, $found := .DeselectedTyres }}
                                <option value="{{ $tyre }}">{{ prettify ($allTyres.Name $tyre (varSplit $f.Cars)) false }} ({{ $tyre }})</option>
                            {{ end }}
                        </select>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="FuelRate" class="col-sm-3 col-form-label">Fuel Rate</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="FuelRate"
                                name="FuelRate"
                                class="form-control"
                                value="{{ $f.FuelRate }}"
                                min="0"

                                step="1"
                        >

                        <small>Fuel usage from 0 (no fuel usage) to XXX (100 is the realistic one)</small>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="DamageMultiplier" class="col-sm-3 col-form-label">Damage Multiplier</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="DamageMultiplier"
                                name="DamageMultiplier"
                                class="form-control"
                                value="{{ $f.DamageMultiplier }}"
                                min="0"
                                step="1"
                        >

                        <small>Damage from 0 (no damage) to 100 (full damage)</small>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="TyreWearRate" class="col-sm-3 col-form-label">Tyre Wear Rate</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="TyreWearRate"
                                name="TyreWearRate"
                                class="form-control"
                                value="{{ $f.TyreWearRate }}"
                                min="0"

                                step="1"
                        >

                        <small>Tyre wear from 0 (no tyre wear) to XXX (100 is the realistic one)</small>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="ForceVirtualMirror" class="col-sm-3 col-form-label">Force Virtual Mirror</label>


                    <div class="col-sm-9">
                        <input type="checkbox"
                               id="ForceVirtualMirror"
                               name="ForceVirtualMirror"
                               {{ if $f.ForceVirtualMirror }}
                                   checked="checked"
                               {{ end }}
                        >
                        <br>

                        <small>Force clients to use Virtual Mirrors (does not work in VR)</small>
                    </div>
                </div>



                <h4>Dynamic Track</h4>

                <div class="form-group row">
                    <label for="SurfacePreset" class="col-sm-3 col-form-label">Surface Preset</label>

                    <div class="col-sm-9">
                        <select name="SurfacePreset" class="form-control" id="SurfacePreset">
                            <option></option>
                            {{ range $index, $preset := .SurfacePresets }}
                                <option value="{{ $index }}">{{ $preset.Name }}: {{ $preset.Description }}</option>
                            {{ end }}
                        </select>

                        <small>Dynamic Track Presets</small>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="SessionStart" class="col-sm-3 col-form-label">Session Start</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="SessionStart"
                                name="SessionStart"
                                class="form-control"
                                value="{{ $f.DynamicTrack.SessionStart }}"


                                step="1"
                        >

                        <small>% level of grip at session start</small>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="Randomness" class="col-sm-3 col-form-label">Randomness</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="Randomness"
                                name="Randomness"
                                class="form-control"
                                value="{{ $f.DynamicTrack.Randomness }}"


                                step="1"
                        >

                        <small>Level of randomness added to the start grip</small>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="SessionTransfer" class="col-sm-3 col-form-label">Session Transfer</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="SessionTransfer"
                                name="SessionTransfer"
                                class="form-control"
                                value="{{ $f.DynamicTrack.SessionTransfer }}"


                                step="1"
                        >

                        <small>How much of the gained grip is to be added to the next session 100 -&gt; all the gained
                            grip. Example: difference between starting (90) and ending (96) grip in the session = 6%,
                            with session_transfer = 50 then the next session is going to start with 93.
                        </small>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="LapGain" class="col-sm-3 col-form-label">Lap Gain</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="LapGain"
                                name="LapGain"
                                class="form-control"
                                value="{{ $f.DynamicTrack.LapGain }}"


                                step="1"
                        >

                        <small>How many laps are needed to add 1% grip</small>
                    </div>
                </div>

            </div>
        </div>


        <div class="card mt-3 border-secondary">
            <div class="card-header">
                <strong>Rules</strong>
            </div>

            <div class="card-body">


                <div class="form-group row">
                    <label for="MaxBallastKilograms" class="col-sm-3 col-form-label">Max Ballast Kilograms</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="MaxBallastKilograms"
                                name="MaxBallastKilograms"
                                class="form-control"
                                value="{{ $f.MaxBallastKilograms }}"
                                min="0"

                                step="1"
                        >

                        <small>The max total of ballast that can be added to an entrant in the entry list or through the admin command</small>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="AllowedTyresOut" class="col-sm-3 col-form-label">Allowed Tyres Out</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="AllowedTyresOut"
                                name="AllowedTyresOut"
                                class="form-control"
                                value="{{ $f.AllowedTyresOut }}"


                                step="1"
                        >

                        <small>The number of tyres allowed outside of track limits before a penalty is applied. -1 disables.</small>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="MaxContactsPerKilometer" class="col-sm-3 col-form-label">Max Contacts Per Kilometer</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="MaxContactsPerKilometer"
                                name="MaxContactsPerKilometer"
                                class="form-control"

                                value="{{ $f.MaxContactsPerKilometer }}"


                                step="1"
                        >

                        <small>Maximum number times you can make contact with another car in 1 kilometer. -1 = no limit. (We had mixed results using this in our testing. Use with caution.)</small>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="StartRule" class="col-sm-3 col-form-label">Start Rule</label>

                    <div class="col-sm-9">

                        <select class="form-control" id="StartRule" name="StartRule">
                            <option value="0" {{ if eq $f.StartRule 0 }} selected="selected" {{ end }}>Car is Locked Until Start</option>
                            <option value="1" {{ if eq $f.StartRule 1 }} selected="selected" {{ end }}>Teleport</option>
                            <option value="2" {{ if eq $f.StartRule 2 }} selected="selected" {{ end }}>Drive Through</option>
                        </select>

                        <small>If race has 3 or less laps then the Teleport penalty is enabled.</small>
                    </div>
                </div>


                {{ if and (not $.IsChampionship) (not $.IsRaceWeekend) }}
                    <div class="form-group row">
                        <label for="LoopMode" class="col-sm-3 col-form-label">Loop Mode</label>


                        <div class="col-sm-9">
                            <input
                                    type="checkbox"
                                    id="LoopMode"
                                    name="LoopMode"
                                    {{ if $f.LoopMode }}
                                        checked="checked"
                                    {{ end }}
                            >
                            <br>

                            <small>The server restarts from the first event after the previous event has finished</small>
                        </div>
                    </div>
                {{ end }}

                <div class="form-group row">
                    <label for="ResultScreenTime" class="col-sm-3 col-form-label">Result Screen Time</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="ResultScreenTime"
                                name="ResultScreenTime"
                                class="form-control"
                                {{ with $f.ResultScreenTime }}
                                    value="{{ . }}"
                                {{ end }}
                                min="0"
                        >

                        <small>Seconds of result screen between racing sessions</small>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="DisableDRSZones" class="col-sm-3 col-form-label">Disable DRS Zones</label>

                    <div class="col-sm-9">

                        <input
                                class="form-control"
                                type="checkbox"
                                id="DisableDRSZones"
                                name="DisableDRSZones"
                                {{ if $f.DisableDRSZones }}
                                    checked="checked"
                                {{ end }}
                        ><br/>

                        <small>
                            When ON, the track's drs_zones.ini will temporarily be replaced with a file that disables DRS across the entire track.
                            This is useful for tracks which do not have any clearly defined zones, or for if you want to race without DRS!

                            <strong>
                                Note: this changes actual track files, so if you're using a multi-server setup pointing to the same content folder,
                                this may cause problems if you're running races at the same track simultaneously.
                            </strong>
                        </small>
                    </div>
                </div>
            </div>
        </div>

        {{ if $.ShowOverridePasswordCard }}
            <div class="card mt-3 border-secondary">
                <div class="card-header">
                    <strong>Server Options</strong>
                </div>
                <div class="card-body">
                    <div class="form-group row">
                        <label for="OverridePassword" class="col-sm-3 col-form-label">Override Server Password</label>

                        <div class="col-sm-9">

                            <input
                                    class="form-control"
                                    type="checkbox"
                                    id="OverridePassword"
                                    name="OverridePassword"
                                    {{ if .OverridePassword }}
                                        checked="checked"
                                    {{ end }}
                            ><br/>

                            <small>If enabled then the server password will be replaced for this event.</small>
                        </div>
                    </div>

                    <div class="form-group row" id="ReplacementPasswordWrapper" {{ if not .OverridePassword }} style="display: none;" {{ end }}>
                        <label for="ReplacementPassword" class="col-sm-3 col-form-label">Replacement Password</label>

                        <div class="col-sm-9">

                            <input
                                    class="form-control"
                                    type="password"
                                    autocomplete="new-password"
                                    id="ReplacementPassword"
                                    name="ReplacementPassword"
                                    value="{{ .ReplacementPassword }}"
                            >

                            <small>If left empty then the server will have no password.</small>
                        </div>
                    </div>

                    {{ if and (not .IsChampionship) (not .IsRaceWeekend) }}
                        <div class="form-group row">
                            <label for="ForceStopTime" class="col-sm-3 col-form-label">Force Stop Time</label>

                            <div class="col-sm-9">
                                <input
                                        type="number"
                                        id="ForceStopTime"
                                        name="ForceStopTime"
                                        class="form-control"
                                        {{ with .ForceStopTime }}
                                            value="{{ . }}"
                                        {{ end }}
                                        min="0"
                                >

                                <small>Maximum number of minutes that this event will run for (across all sessions) before the server will forcibly stop. This will allow for auto loop track rotation even if there are no drivers on the server. Disabled if 0. WARNING: results files will not be written out if an event is forcibly stopped!</small>
                            </div>
                        </div>

                        <div class="form-group row">
                            <label for="ForceStopWithDrivers" class="col-sm-3 col-form-label">Force Stop With Drivers</label>

                            <div class="col-sm-9">

                                <input
                                        class="form-control"
                                        type="checkbox"
                                        id="ForceStopWithDrivers"
                                        name="ForceStopWithDrivers"
                                        {{ if .ForceStopWithDrivers }}
                                            checked="checked"
                                        {{ end }}
                                ><br/>

                                <small>If enabled then the server will forcibly stop after the Force Stop Time even if there are drivers on the server.</small>
                            </div>
                        </div>
                    {{ end }}

                </div>
            </div>
        {{ end }}

        {{ if .IsChampionship }}
            <div class="card mt-3 border-primary">
                <div class="card-header text-white bg-primary">
                    <strong>Save Championship Event</strong>
                </div>
                <div class="card-body">

                    {{ if .IsEditing }}
                        <p>
                            This edited setup will overwrite the {{ add .ChampionshipEventIndex 1 }}{{ ordinal (add .ChampionshipEventIndex 1) }}
                            Event in the <strong>{{ .Championship.Name }}</strong> Championship.
                        </p>
                    {{ else }}
                        <p>
                            When this event is saved, it will be added to the <strong>{{ .Championship.Name }}</strong> Championship.
                            You can add more events below, or, if you're done creating the Championship, you can complete its setup here.
                        </p>
                    {{ end }}

                    <div class="float-right mt-5">

                        {{ if not .IsEditing }}
                            <button class="btn btn-primary" data-toggle="tooltip" name="action" value="addAnotherRace" type="submit" title="Save this setup and then configure another">Add another Event</button>
                            <button class="btn btn-success" data-toggle="tooltip" name="action" value="saveChampionship" type="submit" title="Save this event setup and finish creating the championship">Finish Creating Championship</button>
                        {{ else }}
                            <input type="hidden" name="Editing" id="Editing" value="{{ .EditingID }}">
                            <button class="btn btn-primary" data-toggle="tooltip" name="action" value="saveChampionship" type="submit">Save Event</button>
                        {{ end }}
                   </div>
                </div>
            </div>
        {{ else if $.IsRaceWeekend }}
            <div class="card mt-3 border-primary">
                <div class="card-header text-white bg-primary">
                    <strong>Save Race Weekend Session</strong>
                </div>
                <div class="card-body">
                    <div class="form-group row">
                        <label for="ParentSessions" class="col-sm-3 col-form-label">Parent Session(s)</label>

                        <div class="col-sm-9">
                            <select name="ParentSessions" id="ParentSessions" class="form-control" multiple>
                                <option value="{{ $.RaceWeekend.ID.String }}" {{ if $.RaceWeekendSession.HasParent $.RaceWeekend.ID.String }}selected="selected"{{ end }}>Race Weekend EntryList</option>

                                {{ $numSessions := len $.RaceWeekend.Sessions }}

                                {{ range $index, $session := $.RaceWeekend.Sessions }}
                                    {{ if not (and $.IsEditing ($.RaceWeekend.HasParentRecursive $session $.EditingID)) }}
                                        {{ if not (and $.IsEditing (eq $session.ID.String $.EditingID)) }}
                                            <option value="{{ $session.ID.String }}" {{ if or (and (not $.IsEditing) (eq (sub $numSessions 1) $index)) (and $.IsEditing ($.RaceWeekendSession.HasParent $session.ID.String)) }}selected="selected"{{ end }}>{{ $session.SessionInfo.Name }}</option>
                                        {{ end }}
                                    {{ end }}
                                {{ end }}
                            </select>

                            <small>
                                The parent session specifies the session which is used to build the EntryList for this session.
                                The results output of the parent session (plus any applied filters) forms the starting grid for this session.
                                If "No parent" is chosen, then all other choices will be ignored.
                            </small>
                        </div>
                    </div>

                    {{ if $.RaceWeekend.HasLinkedChampionship }}

                        <h3>Session Points</h3>

                        <p>Each Race Weekend Session and Championship Class has its own points tally. Practice and Qualifying sessions by default have 0 points, but can have points if you want.</p>

                        <ul class="nav nav-tabs mt-3" role="tablist">
                            {{ $classCount := 1 }}

                            {{ range $classID, $points := $.RaceWeekendSession.Points }}
                                {{ $class := $.Championship.ClassByID $classID.String }}

                                <li class="nav-item">
                                    <a class="nav-link {{ if eq $classCount 1 }}active{{ end }}"
                                       id="points-{{ $classID.String }}-tab"
                                       data-toggle="tab"
                                       href="#points-{{ $classID.String }}"
                                       role="tab"
                                       {{ if eq $classCount 1 }}aria-selected="true"{{ end }}
                                    >
                                        {{ $class.Name }}
                                    </a>
                                </li>

                                {{ $classCount = add $classCount 1 }}
                            {{ end }}
                        </ul>

                        {{ $classCount = 1 }}

                        <div class="tab-content">
                            {{ range $classID, $points := $.RaceWeekendSession.Points }}
                                {{ $class := $.Championship.ClassByID $classID.String }}

                                <div class="tab-pane fade {{ if eq $classCount 1 }} show active {{ end }}"
                                     id="points-{{ $classID.String }}"
                                     role="tabpanel"
                                     aria-labelledby="points-{{ $classID.String}}-tab"
                                >
                                    <input type="hidden" name="ClassID" value="{{ $classID.String }}">
                                    <input type="hidden" name="NumPointsForClass" value="{{ len $points.Places }}">

                                    {{ template "points" dict "Points" $points "DefaultPoints" $points "IsEditing" true "IsRaceWeekend" true }}
                                </div>

                                {{ $classCount = add $classCount 1 }}
                            {{ end }}
                        </div>
                    {{ end }}

                    {{ if .IsEditing }}
                        <p>
                            This edited setup will overwrite the {{ add .EditingID 1 }}{{ ordinal (add .EditingID 1) }}
                            Session in the <strong>{{ .RaceWeekend.Name }}</strong> Race Weekend.
                        </p>
                    {{ else }}
                        <p>
                            When this Session is saved, it will be added to the <strong>{{ .RaceWeekend.Name }}</strong> Race Weekend.
                            You can add more sessions below, or, if you're done creating the Race Weekend, you can complete its setup here.
                        </p>
                    {{ end }}

                    <div class="float-right">

                        {{ if not .IsEditing }}
                            <button class="btn btn-primary mt-5" data-toggle="tooltip" name="action" value="addAnotherSession" type="submit" title="Save this setup and then configure another">Add another Session</button>
                            <button class="btn btn-success mt-5" data-toggle="tooltip" name="action" value="saveRaceWeekend" type="submit" title="Save this session setup and finish creating the Race Weekend">Finish Creating Race Weekend</button>
                        {{ else }}
                            <input type="hidden" name="Editing" id="Editing" value="{{ .EditingID }}">
                            <button class="btn btn-primary mt-5" data-toggle="tooltip" name="action" value="saveRaceWeekend" type="submit">Save Session</button>
                        {{ end }}
                    </div>
                </div>
            </div>
        {{ else }}
            <div class="card mt-3 border-primary">
                <div class="card-header text-white bg-primary">
                    <strong>Save Custom Race</strong>
                </div>
                <div class="card-body">

                    <div class="form-group row">
                        <label for="CustomRaceName" class="col-sm-3 col-form-label">Custom Race Name</label>

                        <div class="col-sm-9">

                            <input
                                    class="form-control"
                                    type="text"
                                    id="CustomRaceName"
                                    name="CustomRaceName"
                                    value="{{ .CustomRaceName }}"
                                    placeholder="Something to identify this Custom Race"
                            >

                            <small>The name above will be used on the Custom Races page.</small>
                        </div>
                    </div>

                    {{ if not .IsEditing }}
                        <div class="form-group row">
                            <label for="CustomRaceScheduled" class="col-sm-3 col-form-label">Scheduled Race</label>

                            <div class="col-sm-5">

                                <input
                                        class="form-control"
                                        type="date"
                                        id="CustomRaceScheduled"
                                        name="CustomRaceScheduled"
                                        value=""
                                        placeholder=""
                                >

                                <small>If these fields are both populated then the race will start at a scheduled time. This date/time is in your timezone (<span class='timezone'></span>).</small>

                            </div>

                            <div class="col-sm-4">

                                <input
                                        class="form-control"
                                        type="time"
                                        id="CustomRaceScheduledTime"
                                        name="CustomRaceScheduledTime"
                                        value=""
                                        placeholder=""
                                >

                            </div>

                            <input type='hidden' name="CustomRaceScheduledTimezone" class="event-schedule-timezone">
                        </div>

                        <div class="form-group row">
                            <label for="event-schedule-recurrence" class="col-sm-3 col-form-label">Recurrence Rule</label>

                            <div class="col-sm-5">
                                <input type='text' class='form-control' name='event-schedule-recurrence' id='event-schedule-recurrence'>
                                <small>
                                    Visit
                                    <a target="_blank" href="https://www.textmagic.com/free-tools/rrule-generator">RRule Generator</a>
                                    to generate a recurrence rule. Leave blank if not required. Only valid alongside scheduled time.
                                </small>
                            </div>
                        </div>
                    {{ end }}


                    <div class="float-right mt-5">
                        {{ if not .IsEditing }}
                            <button class="btn btn-primary" data-toggle="tooltip" id="save-race-button" name="action" value="justSave" type="submit" title="Save this setup without starting the race">Save Custom Race</button>
                            <button class="btn btn-success" data-toggle="tooltip" id="start-race-button" name="action" value="startRace" type="submit" title="Save this setup and begin the race">Start Race</button>
                        {{ else }}
                            <input type="hidden" name="Editing" id="Editing" value="{{ .EditingID }}">
                            <button class="btn btn-primary" data-toggle="tooltip" name="action" value="justSave" type="submit">Save Race</button>
                        {{ end }}
                    </div>
                </div>
            </div>
        {{ end }}

        <div class="clearfix"></div>
    </form>



    <script type="text/javascript">
        const availableTyres = {{ jsonEncode .Tyres }};
        const possibleEntrants = {{ jsonEncode .PossibleEntrants }};
        const availableCars = {{ jsonEncode .CarOpts.AsMap }};
        const surfacePresets = {{ jsonEncode .SurfacePresets }};
        const fixedSetups = {{ jsonEncode .FixedSetups }};

        const IsEditing = {{ $.IsEditing }};
    </script>
{{ end }}
