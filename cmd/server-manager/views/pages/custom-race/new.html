{{ define "title" }}
    {{ if .IsChampionship }}
        Championship Event
    {{ else }}
        Custom Race
    {{ end }}
{{ end }}

{{ define "content" }}
    {{ $f := .Current }}
    {{ $trackInfo := trackInfo $f.Track $f.TrackLayout }}

    <h1 class="text-center">
        {{ if .IsChampionship }}
            Championship Event
        {{ else }}
            Custom Race
        {{ end }}
    </h1>

    {{ if .IsChampionship }}
        <p>Configure an Event for the <strong>{{ .Championship.Name }}</strong> Championship.</p>
    {{ end }}

    <form class="race-setup" method="post" {{ if .IsChampionship }} action="/championship/{{ .Championship.ID.String }}/event/submit" {{ else }} action="/custom/new/submit" {{ end}} data-safe-submit>

        <div class="card mt-3 border-secondary">
            <div class="card-header">
                <strong>Track{{ if not .IsChampionship }} & Cars {{ end }}</strong>
            </div>

            <div class="card-body">
                <div class="row mb-5">
                    <div class="col-sm-8">
                        <div class="form-group row">
                            <label for="Track" class="col-sm-3 col-form-label">
                                Track
                            </label>

                            <div class="col-sm-9">
                                <select class="form-control" name="Track" id="Track">
                                    {{ range $index, $track := .TrackOpts }}
                                        <option value="{{ $track.Name }}" {{ if eq $track.Name $f.Track }}selected="selected" {{ end }}>
                                            {{ prettify $track.Name false }}
                                        </option>
                                    {{ end }}
                                </select>
                            </div>
                        </div>


                        <div class="form-group row" style="display: none;">
                            <label for="TrackLayout" class="col-sm-3 col-form-label">
                                Track Layout
                            </label>

                            <div class="col-sm-9">
                                <select class="form-control" name="TrackLayout" id="TrackLayout">
                                    {{ range $index, $track := .TrackOpts }}
                                        {{ range $layoutIndex, $layout := $track.Layouts }}
                                            {{ if and (eq $track.Name $f.Track) (eq $layout $f.TrackLayout) }}
                                                <option value="{{ $track.Name }}:{{ $layout }}:current">{{ $layout }}</option>
                                            {{ else }}
                                                <option value="{{ $track.Name }}:{{ $layout }}">{{ $layout }}</option>
                                            {{ end }}
                                        {{ end }}
                                    {{ end }}
                                </select>
                            </div>
                        </div>

                        {{ with $trackInfo }}
                            <div class="form-group row">
                                <label for="PitBoxes" class="col-sm-3 col-form-label">
                                    Pit Boxes
                                </label>

                                <div class="col-sm-9 pit-boxes">
                                    <span id="track-pitboxes">{{ $trackInfo.Pitboxes }}</span>
                                </div>
                            </div>
                        {{ end }}
                    </div>

                    <div class="col-sm-4">
                        <img class="img img-fluid"
                             id="trackImage"
                             src="/content/tracks/{{ $f.Track }}/ui{{ with $f.TrackLayout }}/{{.}}{{ end }}/preview.png"
                             alt="{{ $f.Track }} {{ $f.TrackLayout }}"
                        >
                    </div>
                </div>

                {{ if not .IsChampionship }}

                    <div class="form-group row">
                        <label for="Cars" class="col-sm-2 col-form-label">
                            Cars
                        </label>

                        <div class="col-sm-10">
                            <select multiple required class="form-control Cars" id="Cars" name="Cars" size="15">
                                {{ range $index, $car := .CarOpts }}

                                    {{ $selected := false }}

                                    {{ range $j, $selectedCar := varSplit $f.Cars }}
                                        {{ if eq $selectedCar $car.Name }}
                                            {{ $selected = true }}
                                        {{ end }}
                                    {{ end }}

                                    <option value="{{ $car.Name }}" {{ if $selected }} selected="selected" {{ end }}>{{ prettify $car.Name true }}</option>
                                {{ end }}
                            </select>
                        </div>
                    </div>
                {{ else }}
                    <select multiple class="Cars" id="Cars" name="Cars" style="display: none;">
                        {{ range $index, $car := $.Championship.ValidCarIDs }}
                            <option value="{{ $car }}" selected="selected">{{ prettify $car true }}</option>
                        {{ end }}
                    </select>
                {{ end }}
            </div>
        </div>

        {{ if and .IsChampionship .ChampionshipHasAtLeastOnceRace }}
            <div class="card mt-3 border-info">
                <div class="card-header text-white bg-info">
                    <strong>Save Championship Race</strong>
                </div>
                <div class="card-body">
                    <p>
                        The setup below this panel is identical to the previous race setup that you just configured.
                        This means that if you are happy with those settings, you can go on to create another race.

                        If not, feel free to scroll down and change the configuration of this race.
                    </p>

                    <p>
                        When this race is saved, it will be added to the <strong>{{ .Championship.Name }}</strong> Championship.
                        You can add more races below, or, if you're done creating the championship, you can complete its setup here.
                    </p>

                    <div class="float-right">
                        <button class="btn btn-primary mt-5" data-toggle="tooltip" name="action" value="addAnotherRace" type="submit" title="Save this setup and then configure another">Add another Race</button>
                        <button class="btn btn-success mt-5" data-toggle="tooltip" name="action" value="saveChampionship" type="submit" title="Save this race setup and finish creating the championship">Finish Creating Championship</button>
                    </div>
                </div>
            </div>
        {{ end }}


        <div class="card mt-3 border-secondary">
            <div class="card-header">
                <strong>Sessions</strong>
            </div>

            <div class="card-body">
                <ul class="nav nav-tabs" role="tablist">

                    {{ range $index, $sessionType := .AvailableSessions }}

                        {{ $hasSession := $f.HasSession $sessionType }}

                        <li class="nav-item">
                            <a class="nav-link {{ if eq $index 0 }}active{{ end }} {{ if $hasSession }} text-success {{ end }}" id="session-{{ $sessionType }}-tab"
                               data-toggle="tab" href="#session-{{ $sessionType }}"
                               role="tab"
                               aria-controls="{{ $sessionType }}" aria-selected="true">{{ $sessionType.String }}</a>
                        </li>
                    {{ end }}
                </ul>
                <div class="tab-content">


                    {{ range $index, $sessionType := .AvailableSessions }}
                        <div class="tab-pane fade {{ if eq $index 0 }}show active{{ end }} pt-5"
                             id="session-{{ $sessionType }}" role="tabpanel"
                             aria-labelledby="session-{{ $sessionType }}-tab">


                            {{ $hasSession := $f.HasSession $sessionType }}
                            {{ $session := index $f.Sessions $sessionType }}

                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">Enabled</label>

                                <div class="col-sm-9">
                                    <input
                                            type="checkbox"
                                            class="session-enabler"
                                            name="{{ $sessionType }}.Enabled"
                                            id="{{ $sessionType }}.Enabled"

                                            {{ if $hasSession }}
                                            checked="checked"
                                            {{ end }}
                                    >
                                </div>
                            </div>

                            <div class="session-details" {{ if not $hasSession }} style="display: none;" {{ end }}>
                                <div class="form-group row">
                                    <label for="{{ $sessionType }}.Name" class="col-sm-3 col-form-label">Name</label>

                                    <div class="col-sm-9">
                                        <input type="text" id="{{ $sessionType }}.Name" name="{{ $sessionType }}.Name"
                                               class="form-control" value="{{ with $session.Name }}{{ . }}{{ else }}{{ $sessionType.String }}{{ end }}">

                                        <small></small>
                                    </div>
                                </div>


                                {{ if eq $sessionType "RACE" }}
                                    <div class="form-group row">
                                        <div class="col-sm-3">
                                            <select id="TimeOrLaps" class="form-control">
                                                <option value="Time" {{ if ne $session.Time 0 }} selected="selected" {{ end }}>Time</option>
                                                <option value="Laps" {{ if ne $session.Laps 0 }} selected="selected" {{ end }}>Laps</option>
                                            </select>
                                        </div>

                                        <div class="col-sm-9" id="RaceTime" {{ if eq $session.Time 0 }}style="display: none;"{{ end }}>
                                            <input
                                                    type="number"
                                                    id="Race.Time"
                                                    name="Race.Time"
                                                    class="form-control"
                                                    value="{{ $session.Time }}"


                                                    step="1"
                                            >

                                            <small>Session length in minutes</small>
                                        </div>


                                        <div class="col-sm-9" id="RaceLaps" {{ if eq $session.Laps 0 }}style="display: none;"{{ end }}>
                                            <input
                                                    type="number"
                                                    id="Race.Laps"
                                                    name="Race.Laps"
                                                    class="form-control"
                                                    value="{{ $session.Laps }}"


                                                    step="1"
                                            >

                                            <small>Number of laps in the race</small>
                                        </div>
                                    </div>
                                {{ else }}
                                    <div class="form-group row">
                                        <label for="{{ $sessionType }}.Time"
                                               class="col-sm-3 col-form-label">Time</label>


                                        <div class="col-sm-9">
                                            <input
                                                    type="number"
                                                    id="{{ $sessionType }}.Time"
                                                    name="{{ $sessionType }}.Time"
                                                    class="form-control"
                                                    value="{{ with $session.Time }}{{ . }}{{ else }}15{{ end }}"
                                                    step="1"
                                            >

                                            <small>Session length in minutes</small>
                                        </div>
                                    </div>

                                {{ end }}

                                {{ if ne $sessionType "BOOK" }}

                                    <div class="form-group row">
                                        <label for="{{ $sessionType }}.IsOpen" class="col-sm-3 col-form-label">
                                            Is Open
                                        </label>
                                            <div class="col-sm-9">
                                                <select class="form-control"
                                                        id="{{ $sessionType }}.IsOpen"
                                                        name="{{ $sessionType }}.IsOpen"
                                                >
                                                    <option value="0" {{ if eq $session.IsOpen 0 }} selected="selected" {{ end }}>No join</option>
                                                    <option value="1" {{ if eq $session.IsOpen 1 }} selected="selected" {{ end }}>Free join</option>

                                                    {{ if eq $sessionType "RACE" }}
                                                        <option value="2" {{ if eq $session.IsOpen 2 }} selected="selected" {{ end }}>
                                                            Free join until 20 seconds to the green light
                                                        </option>
                                                    {{ end }}
                                                </select>

                                                <small>Allow joining during a session, the first session of an event should not be set to
                                                 no join, although subsequent ones can be in order to only allow drivers from the previous
                                                     session to connect.</small>
                                            </div>
                                    </div>

                                {{ end }}

                                {{ if eq $sessionType "RACE" }}

                                    <div class="form-group row">
                                        <label for="{{ $sessionType }}.WaitTime" class="col-sm-3 col-form-label">
                                            Wait Time
                                        </label>

                                        <div class="col-sm-9">
                                            <input
                                                    type="number"
                                                    id="{{ $sessionType }}.WaitTime"
                                                    name="{{ $sessionType }}.WaitTime"
                                                    class="form-control"
                                                    value="{{ $session.WaitTime }}"


                                                    step="1"
                                            >

                                            <small>Seconds before the start of the session</small>
                                        </div>
                                    </div>

                                {{ end }}


                                {{ if eq $sessionType "RACE" }}
                                    <hr>

                                    <div class="row">

                                        <div class="form-group row col-md-6">
                                            <label for="RacePitWindowStart" class="col-sm-6 col-form-label">Race Pit Window Start</label>

                                            <div class="col-sm-6">
                                                <input
                                                        type="number"
                                                        id="RacePitWindowStart"
                                                        name="RacePitWindowStart"
                                                        class="form-control"
                                                        value="{{ $f.RacePitWindowStart }}"


                                                        step="1"
                                                >

                                                <small>Pit window opens at lap/minute specified</small>
                                            </div>
                                        </div>


                                        <div class="form-group row col-md-6">
                                            <label for="RacePitWindowEnd" class="col-sm-6 col-form-label">Race Pit Window End</label>

                                            <div class="col-sm-6">
                                                <input
                                                        type="number"
                                                        id="RacePitWindowEnd"
                                                        name="RacePitWindowEnd"
                                                        class="form-control"
                                                        value="{{ $f.RacePitWindowEnd }}"


                                                        step="1"
                                                >

                                                <small>Pit window closes at lap/minute specified</small>
                                            </div>
                                        </div>

                                    </div>

                                    <div class="row">
                                        <div class="form-group row col-md-6">
                                            <label for="RaceOverTime" class="col-sm-6 col-form-label">Race Over Time</label>

                                            <div class="col-sm-6">
                                                <input
                                                        type="number"
                                                        id="RaceOverTime"
                                                        name="RaceOverTime"
                                                        class="form-control"
                                                        value="{{ $f.RaceOverTime }}"
                                                        min="0"

                                                        step="1"
                                                >

                                                <small>
                                                    Time remaining in seconds to finish the race from the moment the first one passes on the finish line
                                                </small>
                                            </div>
                                        </div>


                                        <div class="form-group row col-md-6">
                                            <label for="RaceGasPenaltyDisabled" class="col-sm-6 col-form-label">
                                                Race Gas Penalty
                                            </label>


                                            <div class="col-sm-6">
                                                <input
                                                        type="checkbox"
                                                        id="RaceGasPenaltyDisabled"
                                                        name="RaceGasPenaltyDisabled"
                                                        {{ if not $f.RaceGasPenaltyDisabled }}
                                                            checked="checked"
                                                        {{ end }}
                                                >
                                                <br>

                                                <small>
                                                    OFF: no penalization will be  forced, but cuts will be saved in the race result json.<br>
                                                    ON: any cut will be penalized with the gas cut message.
                                                </small>
                                            </div>
                                        </div>

                                    </div>

                                    <div class="row">
                                        <div class="form-group row col-md-6">
                                            <label for="ReversedGridRacePositions" class="col-sm-6 col-form-label" data-toggle="tooltip" title="The race session will be restarted in reversed grid order based on the standings of the previous race. Players disqualified in the first race will start from the back of the grid in the second race, regardless of their position being within the reversed grid range.">
                                                Reversed Grid Race Positions
                                            </label>

                                            <div class="col-sm-6">
                                                <input
                                                        type="number"
                                                        id="ReversedGridRacePositions"
                                                        name="ReversedGridRacePositions"
                                                        class="form-control"
                                                        value="{{ $f.ReversedGridRacePositions }}"


                                                        step="1"
                                                >

                                                <small> 0 = no additional race<br/>
                                                    1toX = only those position will be reversed for the next race,<br/>
                                                    -1 = all the positions will be reversed (Retired players will be on the last positions)
                                                </small>
                                            </div>
                                        </div>


                                        <div class="form-group row col-md-6 race-extra-lap" {{ if and (eq $session.Time 0) (ne $session.Laps 0) }} style="display: none;" {{ end }}>
                                            <label for="RaceExtraLap" class="col-sm-6 col-form-label">Extra Lap</label>


                                            <div class="col-sm-6">
                                                <input
                                                        type="checkbox"
                                                        id="RaceExtraLap"
                                                        name="RaceExtraLap"
                                                        {{ if $f.RaceExtraLap }}
                                                            checked="checked"
                                                        {{ end }}
                                                >
                                                <br>

                                                <small>
                                                    If the race is timed, force an extra lap after the leader has crossed the line
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                {{ else if eq $sessionType "QUALIFY" }}
                                    <hr>

                                    <div class="form-group row">
                                        <label for="QualifyMaxWaitPercentage" class="col-sm-3 col-form-label">Qualify Max Wait
                                            Percentage</label>

                                        <div class="col-sm-9">
                                            <input
                                                    type="number"
                                                    id="QualifyMaxWaitPercentage"
                                                    name="QualifyMaxWaitPercentage"
                                                    class="form-control"
                                                    value="{{ $f.QualifyMaxWaitPercentage }}"


                                                    step="1"
                                            >

                                            <small>The factor to calculate the remaining time in a qualify session after the session is
                                                ended: 120
                                                means that 120% of the session fastest lap remains to end the current lap.
                                            </small>
                                        </div>
                                    </div>
                                {{ end }}


                            </div>
                        </div>
                    {{ end }}
                </div>
            </div>
        </div>


        <div class="card mt-3 border-secondary">
            <div class="card-header">
                <strong>Entry List</strong>
            </div>

            <div class="card-body" id="entrants">
                {{ if not .IsChampionship }}
                    <div class="form-group row">
                        <label for="MaxClients" class="col-sm-3 col-form-label">Max Clients</label>

                        <div class="col-sm-9">
                            {{ if gt $.MaxClientsOverride 0 }}
                                <input
                                        type="hidden"
                                        id="MaxClients"
                                        name="MaxClients"
                                        value="{{ $.MaxClientsOverride }}"
                                >

                                Locked to <strong>{{ $.MaxClientsOverride }}</strong><br>
                            {{ else }}
                                <input
                                        type="number"
                                        id="MaxClients"
                                        name="MaxClients"
                                        class="form-control"
                                        value="{{ $f.MaxClients }}"

                                        {{ with $trackInfo }}max="{{ $trackInfo.Pitboxes }}"{{ end }}
                                        step="1"
                                >
                            {{ end }}

                            <small>Maximum number of clients allowed on the server</small>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="LockedEntryList" class="col-sm-3 col-form-label">Locked Entry List</label>


                        <div class="col-sm-9">
                            <input type="checkbox"
                                   id="LockedEntryList"
                                   name="LockedEntryList"
                                   value="{{ $f.LockedEntryList }}"

                                    {{ if eq $f.LockedEntryList 1 }}
                                        checked="checked"
                                    {{ end }}
                            >

                            <br>

                            <small>Only players already included in the entry list can join the server</small>
                        </div>
                    </div>

                    <p>If you add an Entrant once, the next time you add an Entrant, the 'name' input will give you suggestions and auto-populate the Entrant's Name, Team and GUID.</p>

                    <div id="entrantTemplate" class="entrant">
                        {{ template "entrant" }}
                    </div>

                {{ end }}

                {{ range $index, $entrant := .CurrentEntrants.AsSlice }}
                    <div class="entrant">
                        {{ template "entrant" dict "Entrant" $entrant "IsChampionshipEvent" $.IsChampionship }}
                    </div>
                {{ else }}
                    <div class="entrant">
                        {{ template "entrant" }}
                    </div>
                {{ end }}


                {{ if not .IsChampionship }}
                    <div class="text-right">
                        <input class="form-control numEntrantsToAdd" type="number" name="NumEntrantsToAdd" value="1" min="0" max="40">

                        <button class="btn btn-warning addEntrant">Add Entrant(s)</button>
                    </div>
                {{ end }}

                <input type="hidden" class="totalNumEntrants" name="EntryList.NumEntrants" value="{{ if gt 0 (len .CurrentEntrants) }}{{ len .CurrentEntrants }}{{ else }}1{{ end }}">

                <div class="clearfix"></div>
            </div>
        </div>


        <div class="card mt-3 border-secondary">
            <div class="card-header">
                <strong>Assists</strong>
            </div>

            <div class="card-body">

                <div class="form-group row">
                    <label for="ABSAllowed" class="col-sm-3 col-form-label">ABS Allowed</label>

                    <div class="col-sm-9">
                        <select class="form-control" id="ABSAllowed" name="ABSAllowed">
                            <option value="0" {{ if eq $f.ABSAllowed 0 }} selected="selected" {{ end }}>Off</option>
                            <option value="1" {{ if eq $f.ABSAllowed 1 }} selected="selected" {{ end }}>Factory</option>
                            <option value="2" {{ if eq $f.ABSAllowed 2 }} selected="selected" {{ end }}>On</option>
                        </select>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="TractionControlAllowed" class="col-sm-3 col-form-label">
                        Traction Control Allowed
                    </label>

                    <div class="col-sm-9">
                        <select class="form-control" id="TractionControlAllowed" name="TractionControlAllowed">
                            <option value="0" {{ if eq $f.TractionControlAllowed 0 }} selected="selected" {{ end }}>Off</option>
                            <option value="1" {{ if eq $f.TractionControlAllowed 1 }} selected="selected" {{ end }}>Factory</option>
                            <option value="2" {{ if eq $f.TractionControlAllowed 2 }} selected="selected" {{ end }}>On</option>
                        </select>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="StabilityControlAllowed" class="col-sm-3 col-form-label">
                        Stability Control Allowed
                    </label>

                    <div class="col-sm-9">
                        <input type="checkbox"
                               id="StabilityControlAllowed"
                               name="StabilityControlAllowed"
                            {{ if $f.StabilityControlAllowed }}
                                checked="checked"
                            {{ end }}
                        >
                        <br>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="AutoClutchAllowed" class="col-sm-3 col-form-label">Auto Clutch Allowed</label>


                    <div class="col-sm-9">
                        <input type="checkbox"
                               id="AutoClutchAllowed"
                               name="AutoClutchAllowed"
                               {{ if $f.AutoClutchAllowed }}
                                   checked="checked"
                               {{ end }}
                        >
                        <br>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="TyreBlanketsAllowed" class="col-sm-3 col-form-label">Tyre Blankets Allowed</label>


                    <div class="col-sm-9">
                        <input type="checkbox"
                               id="TyreBlanketsAllowed"
                               name="TyreBlanketsAllowed"

                               {{ if $f.TyreBlanketsAllowed }}
                                   checked="checked"
                               {{ end }}
                        >
                        <br>

                        <small>
                            At the start of the session or after a pitstop, tyres will have the the optimal temperature.
                        </small>
                    </div>
                </div>

            </div>
        </div>


        <div class="card mt-3 border-secondary">
            <div class="card-header">
                <strong>Weather</strong>
            </div>

            <div class="card-body">

                <div class="form-group row">
                    <label class="col-sm-3 col-form-label">Sol Integration</label>

                    <div class="col-sm-9">
                        {{ if .SolIsInstalled }}
                            <input
                                    type="checkbox"
                                    class="sol-enabler"
                                    name="Sol.Enabled"
                                    id="Sol.Enabled"

                                    {{ if $f.IsSol }}
                                        checked="checked"
                                    {{ end }}
                            >

                            <br>
                            <small>Allows for 24 hour time cycles. The server treats time differently if enabled. Clients also require Sol and Content Manager</small>
                        {{ else }}
                            <p class="text-danger">Sol isn't installed. Please <a href="/weather">upload your Sol weathers</a> if you want to use Sol.</p>
                        {{ end }}
                    </div>
                </div>

                <div class="not-sol-settings" {{ if $f.IsSol }} style="display: none;" {{ end }}>


                    <div class="form-group row">
                        <label for="SunAngle" class="col-sm-3 col-form-label">Time Of Day</label>

                        <div class="col-sm-9">
                            <input
                                    type="time"
                                    id="TimeOfDay"
                                    name="TimeOfDay"
                                    class="form-control"
                                    value="16:00"
                            >

                            <small>Used to calculate the Sun Angle (below)</small>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="SunAngle" class="col-sm-3 col-form-label">Sun Angle</label>

                        <div class="col-sm-9">
                            <input
                                    type="number"
                                    id="SunAngle"
                                    name="SunAngle"
                                    class="form-control"
                                    value="{{ $f.SunAngle }}"


                                    step="1"
                            >

                            <small>Angle of the position of the sun</small>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="TimeOfDayMultiplier" class="col-sm-3 col-form-label">Time Of Day Multiplier</label>

                        <div class="col-sm-9">
                            <input
                                    type="number"
                                    id="TimeOfDayMultiplier"
                                    name="TimeOfDayMultiplier"
                                    class="form-control"
                                    value="{{ $f.TimeOfDayMultiplier }}"
                                    min="0"
                                    step="1"
                            >

                            <small>Multiplier for the time of day</small>
                        </div>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="WindBaseSpeedMin" class="col-sm-3 col-form-label">Wind Base Speed Min</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="WindBaseSpeedMin"
                                name="WindBaseSpeedMin"
                                class="form-control"
                                value="{{ $f.WindBaseSpeedMin }}"
                                min="0"
                                step="1"
                        >

                        <small>Min speed of the session possible</small>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="WindBaseSpeedMax" class="col-sm-3 col-form-label">Wind Base Speed Max</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="WindBaseSpeedMax"
                                name="WindBaseSpeedMax"
                                class="form-control"
                                value="{{ $f.WindBaseSpeedMax }}"
                                max="40"

                                step="1"
                        >

                        <small>Max speed of session possible (max 40)</small>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="WindBaseDirection" class="col-sm-3 col-form-label">Wind Base Direction</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="WindBaseDirection"
                                name="WindBaseDirection"
                                class="form-control"
                                value="{{ $f.WindBaseDirection }}"


                                step="1"
                        >

                        <small>Base direction of the wind (wind is pointing at); 0 = North, 90 = East etc</small>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="WindVariationDirection" class="col-sm-3 col-form-label">Wind Variation Direction</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="WindVariationDirection"
                                name="WindVariationDirection"
                                class="form-control"
                                value="{{ $f.WindVariationDirection }}"


                                step="1"
                        >

                        <small>Variation (&#43; or -) of the base direction</small>
                    </div>
                </div>

                <hr>

                <p>Each new session will <strong>randomly select</strong> its weather configuration from the below options.</p>

                <div class="row">

                    {{ $weatherIndex := 0 }}
                    {{ $weatherOptions := .Weather }}

                    {{ range $index, $weather := $f.Weather }}

                        <div class="col-sm-12 weather">
                            <div class="card mb-5 border-info">
                                <div class="card-header">
                                    <strong class="weather-num">{{ $weatherIndex }}</strong>

                                    <a href="#"
                                       class="float-right text-danger weather-delete"
                                       title="Delete this Weather"
                                       {{ if eq $weatherIndex 0 }}
                                           style="display: none;"
                                       {{ end }}
                                    >
                                        <i class="fa fa-trash"></i>
                                    </a>
                                </div>

                                <div class="card-body row">

                                    <div class="col-sm-7">

                                        <div class="sol-settings" {{ if not $f.IsSol }} style="display: none;" {{ end }}>

                                            <div class="form-group row">
                                                <label class="col-sm-3 col-form-label col-form-label-sm">Session Start Date/Time</label>

                                                <div class="col-sm-9 p-0" id='date-time-picker'>
                                                    <input
                                                            type='datetime-local'
                                                            id="DateUnix"
                                                            name="DateUnix"
                                                            class="form-control"
                                                            value="{{ ($weather.UnixToTime $weather.CMWFXDateUnModified) | date "2006-01-02T15:04" }}"
                                                    >
                                                </div>
                                            </div>

                                            <div class="form-group row">
                                                <label class="col-sm-3 col-form-label col-form-label-sm">Time Progression Multiplier</label>

                                                <div class="col-sm-9 p-0">
                                                    <input
                                                            type="number"
                                                            id="TimeMulti"
                                                            name="TimeMulti"
                                                            class="form-control"
                                                            value="{{ $weather.CMWFXTimeMulti }}"
                                                            step="1"
                                                    >

                                                    <small>E.g. at 60x 24 hours in game will pass in 24 minutes real time</small>
                                                </div>
                                            </div>

                                        </div>

                                        <div class="form-group row">
                                            <label class="col-sm-3 col-form-label col-form-label-sm" for="Graphics">Graphics</label>

                                            <select name="Graphics" id="Graphics" class="form-control form-control-sm weather-graphics col-sm-9">
                                                {{ range $weatherKey, $weatherName := $weatherOptions }}
                                                    <option value="{{ $weatherKey }}" {{ if eq $weatherKey ($weather.TrimName $weather.Graphics) }} selected="selected" {{ end }}>
                                                        {{ $weatherName }}
                                                    </option>
                                                {{ end }}
                                            </select>
                                        </div>

                                        <div class="row">
                                            <div class="form-group col-sm-6">
                                                <label><small>Base Temperature Ambient</small></label>
                                                <input
                                                        type="number"
                                                        id="BaseTemperatureAmbient"
                                                        name="BaseTemperatureAmbient"
                                                        class="form-control form-control-sm"
                                                        value="{{ $weather.BaseTemperatureAmbient }}"


                                                        step="1"
                                                >
                                            </div>


                                            <div class="form-group col-sm-6">
                                                <label><small>Base Temperature Road</small></label>
                                                <input
                                                        type="number"
                                                        id="BaseTemperatureRoad"
                                                        name="BaseTemperatureRoad"
                                                        class="form-control form-control-sm"
                                                        value="{{ $weather.BaseTemperatureRoad }}"


                                                        step="1"
                                                >

                                                <small>This value will be added to the final ambient
                                                    temp. Value can be negative.
                                                </small>
                                            </div>
                                        </div>


                                        <div class="row">
                                            <div class="form-group col-sm-6">
                                                <label><small>Variation Ambient</small></label>

                                                <input
                                                        type="number"
                                                        id="VariationAmbient"
                                                        name="VariationAmbient"
                                                        class="form-control form-control-sm"
                                                        value="{{ $weather.VariationAmbient }}"


                                                        step="1"
                                                >

                                                <small>Variation of the ambient&#39;s temperature. In this example final ambient&#39;s
                                                    temperature can be 16 or 20
                                                </small>
                                            </div>


                                            <div class="form-group col-sm-6">
                                                <label><small>Variation Road</small></label>

                                                <input
                                                        type="number"
                                                        id="VariationRoad"
                                                        name="VariationRoad"
                                                        class="form-control form-control-sm"
                                                        value="{{ $weather.VariationRoad }}"


                                                        step="1"
                                                >

                                                <small>Variation of the road&#39;s temperature. Like the ambient one</small>
                                            </div>
                                        </div>
                                    </div>


                                    <div class="col-sm-5">
                                        <img class="img img-fluid weather-preview mb-3" src="/content/weather/{{ $weather.TrimName $weather.Graphics }}/preview.jpg" alt="{{ $weather.TrimName $weather.Graphics }}">
                                    </div>

                                </div>
                            </div>
                        </div>

                        {{ $weatherIndex = add $weatherIndex 1 }}
                    {{ end }}
                </div>

                <button class="btn btn-primary float-right" id="addWeather">Add Weather</button>

                <div class="clearfix mb-5"></div>

            </div>

        </div>


        <div class="card mt-3 border-secondary">
            <div class="card-header">
                <strong>Realism</strong>
            </div>

            <div class="card-body">


                <div class="form-group row">
                    <label for="LegalTyres" class="col-sm-3 col-form-label">Legal Tyres</label>

                    {{ $allTyres := .Tyres }}

                    <div class="col-sm-9">
                        <select multiple class="form-control" id="LegalTyres" name="LegalTyres">
                            {{ range $index, $tyre := varSplit $f.LegalTyres }}
                                <option value="{{ $tyre }}" selected="selected">{{ prettify ($allTyres.Name $tyre (varSplit $f.Cars)) false }} ({{ $tyre }})</option>
                            {{ end }}

                            {{ range $tyre, $found := .DeselectedTyres }}
                                <option value="{{ $tyre }}">{{ prettify ($allTyres.Name $tyre (varSplit $f.Cars)) false }} ({{ $tyre }})</option>
                            {{ end }}
                        </select>

                        <small>List of tyres short names that are allowed</small>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="FuelRate" class="col-sm-3 col-form-label">Fuel Rate</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="FuelRate"
                                name="FuelRate"
                                class="form-control"
                                value="{{ $f.FuelRate }}"
                                min="0"

                                step="1"
                        >

                        <small>Fuel usage from 0 (no fuel usage) to XXX (100 is the realistic one)</small>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="DamageMultiplier" class="col-sm-3 col-form-label">Damage Multiplier</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="DamageMultiplier"
                                name="DamageMultiplier"
                                class="form-control"
                                value="{{ $f.DamageMultiplier }}"
                                min="0"
                                min="100"
                                step="1"
                        >

                        <small>Damage from 0 (no damage) to 100 (full damage)</small>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="TyreWearRate" class="col-sm-3 col-form-label">Tyre Wear Rate</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="TyreWearRate"
                                name="TyreWearRate"
                                class="form-control"
                                value="{{ $f.TyreWearRate }}"
                                min="0"

                                step="1"
                        >

                        <small>Tyre wear from 0 (no tyre wear) to XXX (100 is the realistic one)</small>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="ForceVirtualMirror" class="col-sm-3 col-form-label">Force Virtual Mirror</label>


                    <div class="col-sm-9">
                        <input type="checkbox"
                               id="ForceVirtualMirror"
                               name="ForceVirtualMirror"
                               {{ if $f.ForceVirtualMirror }}
                                   checked="checked"
                               {{ end }}
                        >
                        <br>

                        <small>Force clients to use Virtual Mirrors (does not work in VR)</small>
                    </div>
                </div>



                <h4>Dynamic Track</h4>

                <div class="form-group row">
                    <label for="SurfacePreset" class="col-sm-3 col-form-label">Surface Preset</label>

                    <div class="col-sm-9">
                        <select name="SurfacePreset" class="form-control" id="SurfacePreset">
                            <option></option>
                            {{ range $index, $preset := .SurfacePresets }}
                                <option value="{{ $index }}">{{ $preset.Name }}: {{ $preset.Description }}</option>
                            {{ end }}
                        </select>

                        <small>Dynamic Track Presets</small>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="SessionStart" class="col-sm-3 col-form-label">Session Start</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="SessionStart"
                                name="SessionStart"
                                class="form-control"
                                value="{{ $f.DynamicTrack.SessionStart }}"


                                step="1"
                        >

                        <small>% level of grip at session start</small>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="Randomness" class="col-sm-3 col-form-label">Randomness</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="Randomness"
                                name="Randomness"
                                class="form-control"
                                value="{{ $f.DynamicTrack.Randomness }}"


                                step="1"
                        >

                        <small>Level of randomness added to the start grip</small>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="SessionTransfer" class="col-sm-3 col-form-label">Session Transfer</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="SessionTransfer"
                                name="SessionTransfer"
                                class="form-control"
                                value="{{ $f.DynamicTrack.SessionTransfer }}"


                                step="1"
                        >

                        <small>How much of the gained grip is to be added to the next session 100 -&gt; all the gained
                            grip. Example: difference between starting (90) and ending (96) grip in the session = 6%,
                            with session_transfer = 50 then the next session is going to start with 93.
                        </small>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="LapGain" class="col-sm-3 col-form-label">Lap Gain</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="LapGain"
                                name="LapGain"
                                class="form-control"
                                value="{{ $f.DynamicTrack.LapGain }}"


                                step="1"
                        >

                        <small>How many laps are needed to add 1% grip</small>
                    </div>
                </div>

            </div>
        </div>


        <div class="card mt-3 border-secondary">
            <div class="card-header">
                <strong>Rules</strong>
            </div>

            <div class="card-body">


                <div class="form-group row">
                    <label for="MaxBallastKilograms" class="col-sm-3 col-form-label">Max Ballast Kilograms</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="MaxBallastKilograms"
                                name="MaxBallastKilograms"
                                class="form-control"
                                value="{{ $f.MaxBallastKilograms }}"
                                min="0"

                                step="1"
                        >

                        <small>The max total of ballast that can be added through the admin command</small>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="AllowedTyresOut" class="col-sm-3 col-form-label">Allowed Tyres Out</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="AllowedTyresOut"
                                name="AllowedTyresOut"
                                class="form-control"
                                value="{{ $f.AllowedTyresOut }}"


                                step="1"
                        >

                        <small>The number of tyres allowed outside of track limits before a penalty is applied. -1 disables.</small>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="MaxContactsPerKilometer" class="col-sm-3 col-form-label">Max Contacts Per Kilometer</label>

                    <div class="col-sm-9">
                        <input
                                type="number"
                                id="MaxContactsPerKilometer"
                                name="MaxContactsPerKilometer"
                                class="form-control"
                                value="{{ $f.MaxContactsPerKilometer }}"


                                step="1"
                        >

                        <small>Maximum number times you can make contact with another car in 1 kilometer. -1 = no limit</small>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="PickupModeEnabled" class="col-sm-3 col-form-label">Pickup Mode Enabled</label>

                    <div class="col-sm-9">
                        <input
                                type="checkbox"
                                id="PickupModeEnabled"
                                name="PickupModeEnabled"
                                class="form-control"
                                {{ if $f.PickupModeEnabled }}
                                    checked="checked"
                                {{ end }}
                        ><br>

                        <small>If 0 the server starts in booking mode (<strong>do not use it</strong>).
                            Warning: in pickup mode you have to list only a circuit under TRACK and you need to list a
                            least one car in the entry_list
                        </small>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="LoopMode" class="col-sm-3 col-form-label">Loop Mode</label>


                    <div class="col-sm-9">
                        <input
                                type="checkbox"
                                id="LoopMode"
                                name="LoopMode"
                                {{ if $f.LoopMode }}
                                    checked="checked"
                                {{ end }}
                        >
                        <br>

                        <small>The server restarts from the first event after the previous event has finished</small>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="StartRule" class="col-sm-3 col-form-label">Start Rule</label>

                    <div class="col-sm-9">

                        <select class="form-control" id="StartRule" name="StartRule">
                            <option value="0" {{ if eq $f.StartRule 0 }} selected="selected" {{ end }}>Car is Locked Until Start</option>
                            <option value="1" {{ if eq $f.StartRule 1 }} selected="selected" {{ end }}>Teleport</option>
                            <option value="2" {{ if eq $f.StartRule 2 }} selected="selected" {{ end }}>Drive Through</option>
                        </select>

                        <small>If race has 3 or less laps then the Teleport penalty is enabled.</small>
                    </div>
                </div>
            </div>
        </div>

        {{ if .IsChampionship }}
            <div class="card mt-3 border-info">
                <div class="card-header text-white bg-info">
                    <strong>Save Championship Event</strong>
                </div>
                <div class="card-body">

                    {{ if .IsEditing }}
                        <p>
                            This edited setup will overwrite the {{ add .EditingID 1 }}{{ ordinal (add .EditingID 1) }}
                            Event in the <strong>{{ .Championship.Name }}</strong> Championship.
                        </p>
                    {{ else }}
                        <p>
                            When this event is saved, it will be added to the <strong>{{ .Championship.Name }}</strong> Championship.
                            You can add more events below, or, if you're done creating the championship, you can complete its setup here.
                        </p>
                    {{ end }}

                    <div class="float-right">

                        {{ if not .IsEditing }}
                            <button class="btn btn-primary mt-5" data-toggle="tooltip" name="action" value="addAnotherRace" type="submit" title="Save this setup and then configure another">Add another Event</button>
                            <button class="btn btn-success mt-5" data-toggle="tooltip" name="action" value="saveChampionship" type="submit" title="Save this event setup and finish creating the championship">Finish Creating Championship</button>
                        {{ else }}
                            <input type="hidden" name="Editing" id="Editing" value="{{ .EditingID }}">
                            <button class="btn btn-primary mt-5" data-toggle="tooltip" name="action" value="saveChampionship" type="submit">Edit Event</button>
                        {{ end }}
                   </div>
                </div>
            </div>
        {{ else }}
            <div class="card mt-3 border-info">
                <div class="card-header text-white bg-info">
                    <strong>Save Custom Race</strong>
                </div>
                <div class="card-body">

                    <div class="form-group row">
                        <label for="CustomRaceName" class="col-sm-3 col-form-label">Custom Race Name</label>

                        <div class="col-sm-9">

                            <input
                                    class="form-control"
                                    type="text"
                                    id="CustomRaceName"
                                    name="CustomRaceName"
                                    value="{{ .CustomRaceName }}"
                                    placeholder="Something to identify this Custom Race"
                            >

                            <small>The name above will be used on the Custom Races page.</small>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="CustomRaceScheduled" class="col-sm-3 col-form-label">Scheduled Race</label>

                        <div class="col-sm-5">

                            <input
                                    class="form-control"
                                    type="date"
                                    id="CustomRaceScheduled"
                                    name="CustomRaceScheduled"
                                    value="{{ .CustomRaceScheduledDate }}"
                                    placeholder=""
                            >

                            <small>If these fields are both populated then the race will start at a scheduled time.  This date/time is in the same timezone as the server.</small>

                        </div>

                        <div class="col-sm-4">

                            <input
                                    class="form-control"
                                    type="time"
                                    id="CustomRaceScheduledTime"
                                    name="CustomRaceScheduledTime"
                                    value="{{ .CustomRaceScheduledTime }}"
                                    placeholder=""
                            >

                        </div>
                    </div>


                    <div class="float-right">
                        {{ if not .IsEditing }}
                            <button class="btn btn-primary mt-5" data-toggle="tooltip" id="save-race-button" name="action" value="justSave" type="submit" title="Save this setup without starting the race">Save Custom Race</button>
                            <button class="btn btn-success mt-5" data-toggle="tooltip" id="start-race-button" name="action" value="startRace" type="submit" title="Save this setup and begin the race">Start Race</button>
                        {{ else }}
                            <input type="hidden" name="Editing" id="Editing" value="{{ .EditingID }}">
                            <button class="btn btn-primary mt-5" data-toggle="tooltip" name="action" value="justSave" type="submit">Edit Race</button>
                        {{ end }}
                    </div>
                </div>
            </div>
        {{ end }}

        <div class="clearfix"></div>
    </form>



    <script type="text/javascript">
        const availableTyres = {{ jsonEncode .Tyres }};
        const possibleEntrants = {{ jsonEncode .PossibleEntrants }};
        const availableCars = {{ jsonEncode .CarOpts.AsMap }};
        const surfacePresets = {{ jsonEncode .SurfacePresets }};
        const fixedSetups = {{ jsonEncode .FixedSetups }};
    </script>
{{ end }}
